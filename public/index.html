<!-- index.html ‚Äî Parte 1/9 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bonanza Transportation</title>

  <style>
    :root{ --copper:#a8744f; --ok:#17c964; --warn:#ffcc66; --err:#ff6b6b; }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:#000;color:var(--copper);font-family:Arial,sans-serif}

    /* Header / Logo */
    header{display:flex;justify-content:center;align-items:center;padding:20px 16px}
    .logo-wrap{ position:relative }
    .logo{
      width:180px;height:180px;border-radius:50%;border:2px solid var(--copper);
      object-fit:cover;display:block;position:relative;
      box-shadow:0 0 2px rgba(192,139,92,.35) inset,0 0 8px rgba(0,0,0,.6),0 0 10px rgba(192,139,92,.45);
      filter: drop-shadow(0 0 5px rgba(192,139,92,.45));
    }
    .logo-wrap::after{content:"";position:absolute;inset:-8px;border-radius:50%;box-shadow:0 0 22px 10px rgba(192,139,92,.35);pointer-events:none;}

    /* Layout */
    main{max-width:760px;width:92vw;margin:0 auto 40px;padding:0 16px}
    label{display:block;margin:12px 0 6px;font-weight:700}

    /* Inputs: oscuros en todos (incl. autofill) */
    input,select{
      display:block;width:100%;height:44px;padding:10px 12px;
      background:#1a1a1a;color:var(--copper);border:1px solid #444;border-radius:8px;
      outline:none;
    }
    input:focus,select:focus{border-color:var(--copper);box-shadow:0 0 0 3px rgba(168,116,79,.18)}
    ::placeholder{color:#cba686;opacity:.65}

    /* Fuerza oscuro tambi√©n cuando el navegador autocompleta */
    input:-webkit-autofill,
    input:-webkit-autofill:focus{
      -webkit-text-fill-color: var(--copper);
      transition: background-color 50000s ease-in-out 0s;
      box-shadow: 0 0 0 1000px #1a1a1a inset;
      border:1px solid #444;
    }

    button{
      width:100%;padding:14px 16px;margin-top:18px;background:var(--copper);color:#000;
      font-weight:700;font-size:18px;border:0;border-radius:10px;cursor:pointer;
    }
    button:disabled{opacity:0.5;cursor:not-allowed;}
    
    #map{height:380px;margin-top:10px;border-radius:12px;overflow:hidden}

    /* Trip Summary */
    #info{
      display:none;margin-top:18px;border-radius:16px;padding:18px;
      background:linear-gradient(180deg,#121212,#0b0b0b);
      border:1px solid rgba(192,139,92,.28);box-shadow:0 18px 40px rgba(0,0,0,.55);
      color:#e9d5c1;font-size:.95em;
    }
    .info-title{font-weight:800;margin:0 0 4px;font-size:1.05rem}
    .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:10px 0 12px;}
    .kpi{background:#0e0e0e;border:1px solid rgba(192,139,92,.18);border-radius:12px;padding:12px;}
    .kpi .label{font-size:.75rem;opacity:.8;margin-bottom:6px}
    .kpi .value{font-size:1.35rem;font-weight:800;color:#f0d1ad}
    .kpi .unit{font-size:.9rem;opacity:.7;margin-left:4px}
    .kpi .value.price{color:#ffddae}
    .breakdown{margin:6px 0 12px;}
    .breakdown .row{display:flex;justify-content:space-between;padding:6px 0;}
    .breakdown .row.total{font-weight:800;color:#ffddae;font-size:1.05rem}
    .divider{height:1px;background:linear-gradient(90deg,transparent,rgba(192,139,92,.35),transparent);margin:6px 0}

    /* Date/Time */
    .input-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media (max-width:520px){.input-row{grid-template-columns:1fr;}}
    #date,#time{
      height:56px;font-size:17px;border-radius:12px;background:#1f1f1f;color:#fff;
      border:2px solid var(--copper);box-shadow:0 0 0 3px rgba(168,116,79,.18);
    }
    #date:focus,#time:focus{outline:none;border-color:#ffd9a1;box-shadow:0 0 0 4px rgba(255,217,161,.22);}
    input[type="date"]::-webkit-calendar-picker-indicator,
    input[type="time"]::-webkit-calendar-picker-indicator{
      filter:invert(80%) sepia(20%) saturate(180%) hue-rotate(340deg) brightness(110%);
      opacity:.95;cursor:pointer;
    }
    .helper{font-size:.85rem;opacity:.95;margin-top:6px;color:#ffddae;}

    /* Vehicle visual */
    .turntable{margin:10px 0 6px; display:flex; flex-direction:column; align-items:center;}
    .turntable .car{width:260px;height:auto;filter:drop-shadow(0 12px 18px rgba(0,0,0,.6))}
    .turntable .platform{
      width:220px;height:22px;border-radius:50%;
      background:radial-gradient(ellipse at center, rgba(0,0,0,.7) 0%, rgba(0,0,0,.25) 60%, rgba(0,0,0,0) 70%);
      margin-top:6px;
    }
    .vehicle-caption{font-weight:700;color:#ffddae;margin-top:6px;letter-spacing:.2px;}

    /* Vehicle selector */
    .veh-toggle{display:flex;gap:8px;margin:10px 0}
    .veh-btn{
      flex:1 1 0;background:#1a1a1a;border:1px solid rgba(168,116,79,.55);
      color:var(--copper);padding:12px;border-radius:10px;cursor:pointer;font-weight:700
    }
    .veh-btn.active{
      background:var(--copper);color:#000;border-color:var(--copper);
      box-shadow:0 0 0 3px rgba(168,116,79,.25)
    }

    /* Terms compact box */
    .terms-box{border:1px solid rgba(168,116,79,.45);border-radius:12px;padding:10px 12px;margin-top:10px;background:#0e0e0e}
    .terms-summary{
      display:flex;align-items:center;gap:10px;cursor:pointer;
    }
    .terms-summary .chev{
      width:10px;height:10px;border-right:2px solid var(--copper);
      border-bottom:2px solid var(--copper);transform:rotate(-45deg);transition:.2s;margin-left:auto;
    }
    .terms-box.open .terms-summary .chev{transform:rotate(45deg)}

    /* Switch (√∫nico) */
    .accept-pill{
      min-width:28px;height:20px;border-radius:999px;border:1px solid #666;
      display:flex;align-items:center;padding:0 2px;position:relative;background:#1a1a1a;
    }
    .accept-dot{
      width:14px;height:14px;border-radius:50%;background:#333;transition:.2s;
      border:1px solid #555;
    }
    .accept-pill.on{border-color:var(--ok);background:rgba(23,201,100,.12)}
    .accept-pill.on .accept-dot{transform:translateX(8px);background:var(--ok);border-color:var(--ok)}
    .accept-label{font-size:.85rem;opacity:.9;margin-left:8px}

    /* Read-more (2 l√≠neas + degradado) */
    .terms-body{margin-top:10px;color:#e9d5c1;font-size:.95rem;line-height:1.55}
    .terms-content.clamped{
      display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;
      overflow:hidden;position:relative;
    }
    .terms-content.clamped::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:2.2em;
      background:linear-gradient(180deg, rgba(14,14,14,0), rgba(14,14,14,1));
      pointer-events:none;
    }
    .readmore-btn{
      display:inline-block;margin-top:8px;padding:6px 10px;border:1px solid rgba(168,116,79,.55);
      border-radius:8px;background:#1a1a1a;color:#ffddae;font-weight:700;font-size:.85rem;cursor:pointer;
    }

    /* Hints */
    .hint{font-size:.85rem;margin-top:6px}
    .hint.warn{color:var(--warn)}
    .hint.err{color:var(--err)}
    .hint.ok{color:var(--ok)}

    /* Luggage Accordion */
    .luggage-accordion{border:1px solid rgba(168,116,79,.45);border-radius:12px;padding:10px 12px;margin-top:10px;background:#0e0e0e}
    .luggage-summary{display:flex;align-items:center;gap:10px;cursor:pointer}
    .luggage-title{font-weight:700}
    .luggage-chev{width:10px;height:10px;border-right:2px solid var(--copper);border-bottom:2px solid var(--copper);transform:rotate(-45deg);transition:.2s;margin-left:auto}
    .luggage-accordion.open .luggage-chev{transform:rotate(45deg)}
    .luggage-body{display:none;margin-top:10px;color:#e9d5c1;font-size:.95rem;line-height:1.55}
    .luggage-accordion.open .luggage-body{display:block}
    .lug-section h4{margin:6px 0 4px;color:#ffddae}
    .lug-note{opacity:.9;margin:2px 0 8px}
    .lug-list{margin:0 0 10px 18px}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;display:none;background:rgba(0,0,0,.74);align-items:center;justify-content:center;padding:16px;z-index:9999}
    .modal-backdrop.open{display:flex}
    .modal{max-width:860px;width:100%;max-height:86vh;background:#0e0e0e;border:1px solid rgba(168,116,79,.45);border-radius:12px;box-shadow:0 18px 48px rgba(0,0,0,.7);overflow:hidden;display:flex;flex-direction:column}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid rgba(168,116,79,.28);background:#101010}
    .modal-title{font-weight:800;color:#ffddae}
    .modal-body{padding:14px 16px 18px;overflow:auto;color:#e9d5c1;line-height:1.6}
    .close-btn{background:#1a1a1a;border:1px solid rgba(168,116,79,.45);color:#ffddae;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:700}
  </style>
</head>
<!-- index.html ‚Äî Parte 2/9 -->
<body>
  <header>
    <div class="logo-wrap">
      <img class="logo" src="/images/bonanza-logo.PNG" alt="Bonanza Transportation Logo">
    </div>
  </header>

  <main>
    <label for="fullname">Full Name:</label>
    <input id="fullname" type="text" placeholder="e.g. John Doe" autocomplete="name" required />

    <label for="phone">Phone Number (US):</label>
    <input id="phone" type="tel" inputmode="numeric" autocomplete="tel" placeholder="(555) 123-4567" required />
    <div id="phoneHelp" class="hint"></div>

    <label for="email">Email Address:</label>
    <input id="email" type="email" placeholder="you@example.com" autocomplete="email" required />
    <div id="emailHelp" class="hint"></div>

    <label for="pickup">Pick-up Address:</label>
    <input id="pickup" placeholder="e.g. SLC Airport" required />

    <label for="dropoff">Drop-off Address:</label>
    <input id="dropoff" placeholder="e.g. Montage Deer Valley" required />

    <!-- Special Instructions -->
    <label for="specialInstructions">Special Instructions:</label>
    <textarea
      id="specialInstructions"
      placeholder="Add any important details for your driver (e.g., gate code, extra luggage, pickup location)."
      style="display:block;width:100%;height:60px;padding:10px 12px;background:#1a1a1a;color:#a8744f;border:1px solid #444;border-radius:8px;outline:none;resize:none;"
      onfocus="this.style.borderColor='#a8744f'; this.style.boxShadow='0 0 0 3px rgba(168,116,79,.18)';"
      onblur="this.style.borderColor='#444'; this.style.boxShadow='none';"
    ></textarea>

    <div id="flightContainer" style="display:none;">
      <label for="flightNumber">Flight Number:</label>
      <input id="flightNumber" placeholder="e.g. DL1234" />
      <div id="flightHint" class="hint warn" style="display:none">
        ‚úàÔ∏è Enter the complete flight number exactly as it appears on your boarding pass or itinerary.
      </div>

      <!-- Commercial Flight Origin City -->
      <label for="flightOrigin" style="margin-top:12px;">Flight Origin City:</label>
      <input id="flightOrigin" placeholder="e.g. Miami (MIA)" />
      <div id="originHelp" class="hint" style="display:none"></div>
    </div>

    <!-- Private Jet (FBO) -->
    <div id="privateFlightContainer" style="display:none;">
      <label for="tailNumber">Jet Tail Number (N-Number):</label>
      <input id="tailNumber" placeholder="e.g., N123AB" />
      <div id="tailHelp" class="hint" style="display:none"></div>

      <label for="pvtOrigin" style="margin-top:12px;">Flight Origin City:</label>
      <input id="pvtOrigin" placeholder="e.g., Van Nuys (VNY)" />
      <div id="pvtOriginHelp" class="hint" style="display:none"></div>
    </div>

    <div class="input-row">
      <div>
        <label for="date">Date:</label>
        <input id="date" type="date" />
        <div id="dateHelp" class="helper"></div>
      </div>
      <div>
        <label for="time">Time:</label>
        <input id="time" type="time" step="900" />
        <div id="timeHelp" class="helper"></div>
      </div>
    </div>

    <!-- Vehicle selector -->
    <label>Vehicle Type:</label>
    <div class="veh-toggle">
      <button type="button" class="veh-btn active" data-type="suv" aria-pressed="true">
        SUV ‚Äì 1 to 5 Passengers
      </button>
      <button type="button" class="veh-btn" data-type="van" aria-pressed="false">
        Van ‚Äì Up to 12 Passengers
      </button>
    </div>

    <div class="turntable">
      <img id="vehicle-photo" class="car" src="/images/suburban.png" alt="Vehicle">
      <div class="platform"></div>
      <div id="vehicle-caption" class="vehicle-caption">This will be your SUV</div>
    </div>

    <div id="suv-luggage" class="helper">SUV: Fits up to 5 passengers, 5 large bags, 5 carry-ons</div>
    <div id="van-luggage" class="helper" style="display:none">Van: Fits up to 12 passengers, 12 large bags, 8 carry-ons</div>

    <!-- Detailed Luggage Guide (accordion) -->
    <div id="luggageAccordion" class="luggage-accordion" aria-expanded="false">
      <div class="luggage-summary" id="luggageSummary">
        <span class="luggage-title">Detailed Luggage Guide</span>
        <div class="luggage-chev"></div>
      </div>
      <div class="luggage-body" id="luggageBody">
        <!-- SUV details -->
        <div id="lug-suv" class="lug-section">
          <h4>üöô SUV ‚Äì 1 to 5 Passengers</h4>
          <div class="lug-note"><em>Option 1 ‚Äì With Sports Equipment (Ski bags or golf bags)</em></div>
          <ul class="lug-list">
            <li>5 sports equipment items (ski bags or golf bags)</li>
            <li>3 large suitcases (28‚Äì32‚Äù)</li>
            <li>3 small suitcases (20‚Äì24‚Äù)</li>
          </ul>
          <div class="lug-note"><em>Option 2 ‚Äì Without Sports Equipment (Only suitcases and handbags)</em></div>
          <ul class="lug-list">
            <li>4 large suitcases (28‚Äì32‚Äù)</li>
            <li>4 small suitcases (20‚Äì24‚Äù)</li>
          </ul>
        </div>
        <!-- index.html ‚Äî Parte 3/9 -->
        <!-- VAN details -->
        <div id="lug-van" class="lug-section" style="display:none">
          <h4>üöê Van ‚Äì Up to 12 Passengers</h4>
          <div class="lug-note"><em>Option 1 ‚Äì With Sports Equipment (Ski bags or golf bags)</em></div>
          <ul class="lug-list">
            <li>8 sports equipment items (ski bags or golf bags)</li>
            <li>8 large suitcases (28‚Äì32‚Äù)</li>
            <li>Carry-on: 1 per passenger (backpack or small bag)</li>
          </ul>
          <div class="lug-note"><em>Option 2 ‚Äì Without Sports Equipment (Only suitcases and handbags)</em></div>
          <ul class="lug-list">
            <li>12‚Äì14 large suitcases (28‚Äì32‚Äù)</li>
            <li>Carry-on: 1 per passenger (backpack or small bag)</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Terms -->
    <div class="terms-box" id="terms-box">
      <div class="terms-summary">
        <div class="accept-pill" id="acceptPill" tabindex="0" role="switch" aria-checked="false">
          <div class="accept-dot"></div>
        </div>
        <div class="accept-label">I accept the Terms & Conditions</div>
      </div>
      <div class="terms-body">
        <div id="terms-content" class="terms-content clamped">
          By booking with Bonanza Transportation, you agree to our policies including but not limited to payment terms,
          cancellation policy, and liability limits. Please read carefully before proceeding. Bonanza Transportation
          reserves the right to modify or cancel reservations if conditions warrant. Full terms are available upon request.
        </div>
        <button type="button" id="openTermsModal" class="readmore-btn">View Full Terms</button>
      </div>
    </div>

    <!-- Buttons -->
    <button id="calculate" disabled>Calculate Price</button>

    <!-- Map -->
    <div id="map"></div>

    <!-- PAY NOW button -->
    <button id="pay" disabled style="display:none">PAY NOW</button>

    <!-- Trip Summary -->
    <div id="info"></div>
  </main>

  <!-- Terms Modal -->
  <div id="termsModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="termsTitle">
      <div class="modal-header">
        <div class="modal-title" id="termsTitle">Terms and Conditions ‚Äî Bonanza Transportation</div>
        <button type="button" id="closeTerms" class="close-btn">Close</button>
      </div>
      <div class="modal-body" id="termsBody">

        <!-- Summary inside modal -->
        <div id="modal-terms-content" class="terms-content clamped">
          By booking with Bonanza Transportation, you agree to our policies including but not limited to payment terms,
          cancellation policy, and liability limits. Please read carefully before proceeding. Bonanza Transportation
          reserves the right to modify or cancel reservations if conditions warrant. Full terms are available upon request.
        </div>
        <button type="button" id="modalReadMoreBtn" class="readmore-btn" aria-expanded="false">Read More</button>

        <hr style="border:0;border-top:1px solid rgba(168,116,79,.28);margin:12px 0 16px"/>

        <p><strong>Last updated:</strong> 2024</p>
        <hr style="border:0;border-top:1px solid rgba(168,116,79,.28);margin:8px 0 14px"/>

        <h3>1. Introduction and Acceptance</h3>
        <p>Welcome to Bonanza Transportation. By booking, hiring, or using our services, you agree to comply with these Terms and Conditions. We reserve the right to modify them at any time; updated versions will be available on our website and will take effect immediately.</p>

        <h3>2. Definitions</h3>
        <ul>
          <li><strong>Client:</strong> The individual or entity booking services from Bonanza Transportation.</li>
          <li><strong>Service:</strong> Private transportation provided by Bonanza Transportation, including airport pickups, events, transfers, and private trips.</li>
          <li><strong>Booking:</strong> A confirmed service agreement with Bonanza Transportation.</li>
          <li><strong>Cancellation:</strong> Termination of a confirmed booking.</li>
          <li><strong>Fare:</strong> The agreed price for the contracted service.</li>
        </ul><!-- index.html ‚Äî Parte 4/9 -->
        <h3>3. Bookings and Payments</h3>
        <ul>
          <li>Bookings must be made in advance via our website, mobile app, text message, phone, or email.</li>
          <li>Payments may be made by credit/debit card or secure platforms such as Stripe.</li>
          <li>Bonanza Transportation may require partial or full payment at the time of booking confirmation.</li>
          <li>All fares are quoted in U.S. Dollars (USD) and include applicable taxes unless otherwise stated.</li>
          <li>All information provided by the client is their sole responsibility. Bonanza Transportation will only interpret and honor the details exactly as they are written in the booking; we are not responsible for any errors or omissions caused by typos or incorrect information submitted by the client.</li>
        </ul>

        <h3>4. Cancellation and Rescheduling Policy</h3>
        <ul>
          <li>More than 24 hours before service: the client may reschedule at no additional cost, subject to availability.</li>
          <li>Within 24 hours before service: the client may reschedule, but a 50% fee of the agreed fare will apply.</li>
          <li>Rescheduling must be confirmed directly with Bonanza Transportation via phone or email.</li>
        </ul>

        <h3>5. No-Show and Waiting Times</h3>
        <ul>
          <li>A ‚ÄúNo-Show‚Äù will be considered if the client does not arrive at the agreed location and time without prior notice.</li>
          <li><strong>Included waiting time:</strong></li>
          <ul>
            <li>Non-airport locations: up to 20 minutes free of charge.</li>
            <li>Airport pickups: up to 1 hour after landing if the flight is on time.</li>
          </ul>
          <li>After this period, additional waiting charges will apply.</li>
        </ul>

        <h3>6. Flight Delays</h3>
        <ul>
          <li>We monitor flights to adjust pickup times.</li>
          <li>If the flight is delayed, we will make every effort to pick up the client at the new arrival time.</li>
          <li>If the delay is excessive and we cannot wait, the service may be rescheduled subject to availability.</li>
        </ul>

        <h3>7. Luggage and Personal Belongings</h3>
        <ul>
          <li>The client is responsible for informing us at the time of booking about the quantity and size of luggage.</li>
          <li>Bonanza Transportation is not liable for damage or loss of personal belongings left in the vehicle.</li>
        </ul>

        <h3>8. Client Conduct</h3>
        <ul>
          <li>Smoking, drinking alcohol, or using illegal substances inside the vehicles is prohibited.</li>
          <li>Respect towards the driver and vehicle is required.</li>
          <li>The driver may refuse service if the client exhibits aggressive, unsafe, or unlawful behavior.</li>
        </ul>

        <h3>9. Limitation of Liability</h3>
        <ul>
          <li>Bonanza Transportation will not be liable for delays, losses, or damages caused by circumstances beyond our control, such as traffic, weather conditions, accidents, or force majeure events.</li>
          <li>Claims for indirect losses, loss of income, or consequential damages will not be accepted.</li>
        </ul>

        <h3>10. Insurance</h3>
        <ul>
          <li>All our services are covered by commercial insurance in accordance with the laws of the State of Utah.</li>
        </ul>

        <h3>11. Privacy and Personal Data</h3>
        <ul>
          <li>Personal information provided by the client will be treated confidentially and used solely for purposes related to the provision of the service, in accordance with our Privacy Policy.</li>
        </ul>

        <h3>12. Jurisdiction</h3>
        <ul>
          <li>These terms are governed by the laws of the State of Utah, USA.</li>
          <li>Any dispute will be submitted to the competent courts of Utah.</li>
        </ul>

        <h3>Contact</h3>
        <p>üìû Phone: (786) 683-5128<br/>
           üìß Email: bonanzatransportation1@outlook.com<br/>
           üìç Park City, Utah ‚Äì USA</p>
      </div>
    </div>
  </div>
  <!-- index.html ‚Äî Parte 5/9 -->
  <script>
/* ===== Config ===== */
const SUV_IMG = "/images/suburban.png";
const VAN_IMG = "/images/van-sprinter.png";

/* ===== Globals ===== */
let map, directionsService, directionsRenderer, geocoder;
const BASE_ADDRESS = "13742 N Jordanelle Pkwy, Kamas, UT";
let pickupPlace = null, dropoffPlace = null;
let selectedVehicle = 'suv';

/* ===== Operating hours (6:00‚Äì23:00) ===== */
const OPERATING_START = "06:00";
const OPERATING_END   = "23:00";

/* ===== Pricing (tabla oficial) ===== */
function calculateBase(mi){
  if (mi <= 10) return 120;
  if (mi <= 35) return 190;
  if (mi <= 39) return 210;
  if (mi <= 48) return 230;
  if (mi <= 55) return 250;
  return mi * 5.4;
}
function applyVehicleMultiplier(total){
  return (selectedVehicle === 'van') ? Math.round(total * 1.30) : total;
}
function recalcFromCache(){
  const el = document.getElementById('info');
  if (!el || window.__lastBase == null) return;
  const base = window.__lastBase, surcharge = window.__lastSurcharge||0, ahFee = window.__lastAhFee||0;
  const finalTotal = applyVehicleMultiplier(base + surcharge + ahFee);
  const priceEl = el.querySelector('.kpi .value.price');
  const totalEl = el.querySelector('.row.total span:last-child');
  if (priceEl) priceEl.textContent = `$${finalTotal.toFixed(2)}`;
  if (totalEl) totalEl.textContent = `$${finalTotal.toFixed(2)}`;
  window.__lastQuotedTotal = finalTotal;
  window.__vehicleType = selectedVehicle;
}

/* ===== Time helpers ===== */
function nextQuarter(d){ const m=d.getMinutes(); const add=15-(m%15||15); d.setMinutes(m+add,0,0); return d; }
function localISODate(d){ const off=d.getTimezoneOffset()*60000; return new Date(d-off).toISOString().slice(0,10); }
function setTimeValue(el,h,m){ if(el) el.value = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`; }
function isAfterHours(dateStr, timeStr){
  if(!dateStr || !timeStr) return false;
  const d = new Date(`${dateStr}T${timeStr}:00`);
  const [sh,sm] = OPERATING_START.split(':').map(Number);
  const [eh,em] = OPERATING_END.split(':').map(Number);
  const start = new Date(d); start.setHours(sh, sm, 0, 0);
  const end   = new Date(d); end.setHours(eh, em, 0, 0);
  return (d < start) || (d > end);
}
function mountDateTime(){
  const dateEl = document.getElementById('date');
  const timeEl = document.getElementById('time');
  const dateHelp = document.getElementById('dateHelp');
  const timeHelp = document.getElementById('timeHelp');
  const nx = nextQuarter(new Date());
  if(dateEl && !dateEl.value) dateEl.value = localISODate(nx);
  if(timeEl && !timeEl.value) setTimeValue(timeEl, nx.getHours(), nx.getMinutes());
  if(dateEl) dateEl.min = localISODate(new Date());
  function update(){
    if(dateHelp && dateEl?.value){
      const d = new Date(dateEl.value + 'T00:00:00');
      dateHelp.textContent = `Selected: ${d.toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'})}`;
    }
    if(timeHelp && timeEl?.value){ timeHelp.textContent = `Selected: ${timeEl.value}`; }
  }
  dateEl?.addEventListener('change', update);
  timeEl?.addEventListener('change', update);
  update();
}
    <!-- index.html ‚Äî Parte 6/9 -->
/* ===== Google Places helpers ===== */
function isAirport(place){
  const t = place?.types || [];
  return t.includes("airport") || /airport/i.test(place?.name || place?.formatted_address || "");
}
function isUtah(place){
  const addr=(place?.formatted_address||'').toLowerCase();
  return /\but\b/.test(addr) || /, ut(ah)?\b/.test(addr);
}
/* === Private Utah Airport heuristic === */
const FBO_KEYWORDS = /\b(fbo|jet center|private terminal|general aviation|hangar|atlantic aviation|million air|signature( aviation| flight| support)?|ross aviation|tac air|ok3 air|provo jet center|sheltair|jet linx|jet aviation|magellan jets|aero charter|aero center|modern aviation|banyan air service|cutter aviation|lynx|western aircraft)\b/i;
function isPrivateUtahAirport(place){
  if(!place) return false;
  if(!isAirport(place) || !isUtah(place)) return false;
  const text = `${place.name||""} ${place.formatted_address||""}`;
  return FBO_KEYWORDS.test(text);
}
function pickupIsUtahAirport(){ return pickupPlace && isAirport(pickupPlace) && isUtah(pickupPlace); }

function countyFrom(place){
  const comps=place?.address_components||[];
  const c=comps.find(x=>x.types?.includes("administrative_area_level_2"));
  return c?.long_name||"";
}
function routeAsync(opts){ return new Promise((res,rej)=>{ directionsService.route(opts,(r,s)=> s==="OK"&&r?res(r):rej(s||"ROUTE_ERROR")); }); }
function geocodeAsync(req){ return new Promise((res,rej)=>{ geocoder.geocode(req,(results,status)=>{ if(status==="OK"&&results?.[0]) res(results[0]); else rej(status||"GEOCODE_ERROR"); }); }); }
async function countyByPlaceId(placeId){ try{ const r=await geocodeAsync({placeId}); const c=r.address_components.find(c=>c.types.includes("administrative_area_level_2")); return c?.long_name||""; }catch(_){ return ""; } }
async function computeMilesFromBase(placeId){ const r=await routeAsync({origin:BASE_ADDRESS,destination:{placeId},travelMode:google.maps.TravelMode.DRIVING}); return r.routes[0].legs[0].distance.value/1609.34; }

/* ===== Flight number (commercial) ===== */
const AIRLINES = new Set(["AA","DL","UA","WN","AS","B6","F9","NK","HA","AC","AM","AF","BA","KL","LH","VS","IB","TK","QR","EK","CM","AV","QF","CX","AZ","SK","LA","AR","TS","WS","DY","NH","JL","KE","XE"]);
const FLIGHT_REGEX = /^([A-Z0-9]{2})\s?-?\s?(\d{1,4})([A-Z])?$/;
function normalizeFlight(v){ return (v||'').toUpperCase().trim().replace(/\s+/g,' ').replace('‚Äì','-'); }
function validateFlightValue(v){
  const m = normalizeFlight(v).match(FLIGHT_REGEX);
  if (!m) return {ok:false,msg:'Invalid format. Use AA1234 or WN 987.'};
  const code=m[1], num=m[2];
  if(!AIRLINES.has(code)) return {ok:false,msg:'Unknown airline code.'};
  if(/^0+$/.test(num)) return {ok:false,msg:'Invalid flight number.'};
  return {ok:true,msg:''};
}

/* ===== Private Jet validations ===== */
const N_NUMBER_REGEX = /^N[1-9]\d{0,4}([A-HJ-NP-Z]{1,2})?$/i;
function validateNNumber(v){
  const val=(v||"").toUpperCase().trim();
  if(!val) return {ok:false,msg:"Please enter the aircraft tail number (e.g., N123AB)."};
  if(!N_NUMBER_REGEX.test(val)) return {ok:false,msg:"Format: N + 1‚Äì5 digits + optional 1‚Äì2 letters (no I/O)."};
  return {ok:true,msg:"Tail number captured."};
}
function validateCityLike(v, label="origin city"){
  const val=(v||"").trim();
  if(!val) return {ok:false,msg:`Please enter the ${label} (e.g., Van Nuys or Van Nuys (VNY)).`};
  const ok = /^[A-Za-z .,'-]{2,}( \([A-Z]{3}\))?$/.test(val);
  return ok ? {ok:true,msg:`${label[0].toUpperCase()+label.slice(1)} captured.`} : {ok:false,msg:`Use letters and optional airport code, e.g., Van Nuys (VNY).`};
}
    <!-- index.html ‚Äî Parte 7/9 -->
function updateFlightVisibility(){
  const commWrap=document.getElementById('flightContainer');
  const commNum=document.getElementById('flightNumber');
  const commHint=document.getElementById('flightHint');
  const commOrigin=document.getElementById('flightOrigin');
  const commOriginHelp=document.getElementById('originHelp');

  const pvtWrap=document.getElementById('privateFlightContainer');
  const tail=document.getElementById('tailNumber');
  const tailHelp=document.getElementById('tailHelp');
  const pvtOrigin=document.getElementById('pvtOrigin');
  const pvtOriginHelp=document.getElementById('pvtOriginHelp');

  const isUTA = pickupIsUtahAirport();
  const isPvt = isPrivateUtahAirport(pickupPlace);

  /* === Commercial block === */
  if(commWrap){
    const showComm = isUTA && !isPvt;
    commWrap.style.display = showComm ? 'block' : 'none';

    // Acordado: required din√°micos solo cuando se muestra
    if(commNum)   commNum.required   = showComm;
    if(commOrigin)commOrigin.required= showComm;

    if(!showComm){
      if(commNum){ commNum.value=""; commNum.setCustomValidity(""); }
      if(commHint) commHint.style.display='none';
      if(commOrigin){ commOrigin.value=""; commOrigin.setCustomValidity(""); }
      if(commOriginHelp) commOriginHelp.style.display='none';
    }
  }

  /* === Private block === */
  if(pvtWrap){
    const showPvt = isUTA && isPvt;
    pvtWrap.style.display = showPvt ? 'block' : 'none';

    // Acordado: required din√°micos solo cuando se muestra
    if(tail)      tail.required      = showPvt;
    if(pvtOrigin) pvtOrigin.required = showPvt;

    if(!showPvt){
      if(tail){ tail.value=""; tail.setCustomValidity(""); }
      if(tailHelp) tailHelp.style.display='none';
      if(pvtOrigin){ pvtOrigin.value=""; pvtOrigin.setCustomValidity(""); }
      if(pvtOriginHelp) pvtOriginHelp.style.display='none';
    }
  }
}

/* ===== Wire validations (commercial & private) ===== */
function wireFlightValidation(){
  const input=document.getElementById('flightNumber');
  const hint=document.getElementById('flightHint');
  const origin = document.getElementById('flightOrigin');
  const originHelp = document.getElementById('originHelp');

  if(input){
    input.addEventListener('input', ()=>{
      if(!pickupIsUtahAirport() || isPrivateUtahAirport(pickupPlace)){
        input.setCustomValidity(""); if(hint) hint.style.display='none'; return;
      }
      const r=validateFlightValue(input.value);
      input.setCustomValidity(r.ok?"":r.msg);
      if(hint) hint.style.display = input.value.trim().length ? 'block' : 'none';
    });
  }
  if(origin){
    origin.addEventListener('input', ()=>{
      if(!pickupIsUtahAirport() || isPrivateUtahAirport(pickupPlace)){
        origin.setCustomValidity(""); if(originHelp) originHelp.style.display='none'; return;
      }
      const r = validateCityLike(origin.value, "origin city");
      origin.setCustomValidity(r.ok?"":r.msg);
      if(originHelp){
        originHelp.textContent = r.msg || 'Origin city captured.';
        originHelp.className = 'hint ' + (r.ok ? 'ok' : 'warn');
        originHelp.style.display='block';
      }
    });
  }

  const tail = document.getElementById('tailNumber');
  const tailHelp = document.getElementById('tailHelp');
  const pvtOrigin = document.getElementById('pvtOrigin');
  const pvtOriginHelp = document.getElementById('pvtOriginHelp');

  if(tail){
    tail.addEventListener('input', ()=>{
      if(!isPrivateUtahAirport(pickupPlace)){
        tail.setCustomValidity(""); if(tailHelp) tailHelp.style.display='none'; return;
      }
      const r = validateNNumber(tail.value);
      tail.setCustomValidity(r.ok?"":r.msg);
      if(tailHelp){
        tailHelp.textContent = r.msg || 'Tail number captured.';
        tailHelp.className = 'hint ' + (r.ok ? 'ok' : 'warn');
        tailHelp.style.display='block';
      }
    });
  }
  if(pvtOrigin){
    pvtOrigin.addEventListener('input', ()=>{
      if(!isPrivateUtahAirport(pickupPlace)){
        pvtOrigin.setCustomValidity(""); if(pvtOriginHelp) pvtOriginHelp.style.display='none'; return;
      }
      const r = validateCityLike(pvtOrigin.value, "origin city");
      pvtOrigin.setCustomValidity(r.ok?"":r.msg);
      if(pvtOriginHelp){
        pvtOriginHelp.textContent = r.msg || 'Origin city captured.';
        pvtOriginHelp.className = 'hint ' + (r.ok ? 'ok' : 'warn');
        pvtOriginHelp.style.display='block';
      }
    });
  }
}

/* ===== Vehicle selector + photo & guides ===== */
(function wireVehicleSelector(){
  const suv = document.querySelector('.veh-btn[data-type="suv"]');
  const van = document.querySelector('.veh-btn[data-type="van"]');
  const vanGuide = document.getElementById('van-luggage');
  const suvGuide = document.getElementById('suv-luggage');
  const photo = document.getElementById('vehicle-photo');
  const caption = document.getElementById('vehicle-caption');

  const lugSUV = document.getElementById('lug-suv');
  const lugVAN = document.getElementById('lug-van');

  function setVehicle(type){
    selectedVehicle = type;
    [suv,van].forEach(b=>{
      const on = b && b.dataset.type===type;
      if(!b) return;
      b.classList.toggle('active', on);
      b.setAttribute('aria-pressed', String(on));
    });
    const isVan = (type==='van');
    if(vanGuide) vanGuide.style.display = isVan ? 'block' : 'none';
    if(suvGuide) suvGuide.style.display = isVan ? 'none' : 'block';
    if(photo) photo.src = isVan ? VAN_IMG : SUV_IMG;
    if(caption) caption.textContent = isVan ? 'This will be your Van' : 'This will be your SUV';
    if(lugSUV) lugSUV.style.display = isVan ? 'none' : 'block';
    if(lugVAN) lugVAN.style.display = isVan ? 'block' : 'none';
    recalcFromCache();
  }
  suv?.addEventListener('click', ()=> setVehicle('suv'));
  van?.addEventListener('click', ()=> setVehicle('van'));
  setVehicle('suv');
})();
    <!-- index.html ‚Äî Parte 8/9 -->
/* ===== Render Summary ===== */
function renderInfo(leg, base, surcharge, afterHours){
  const miles = leg.distance.value / 1609.34;
  const ahFee = afterHours ? (base + surcharge) * 0.20 : 0;

  window.__lastBase = base;
  window.__lastSurcharge = surcharge;
  window.__lastAhFee = ahFee;

  const finalTotal = applyVehicleMultiplier(base + surcharge + ahFee);
  const hasExtra = (surcharge > 0) || (ahFee > 0);

  const el = document.getElementById("info");
  el.style.display = "block";
  el.innerHTML = `
    <h3 class="info-title">Trip Summary</h3>
    <div class="kpis">
      <div class="kpi"><div class="label">Distance</div><div class="value">${miles.toFixed(1)}<span class="unit">mi</span></div></div>
      <div class="kpi"><div class="label">Duration</div><div class="value">${leg.duration.text}</div></div>
      <div class="kpi"><div class="label">Price</div><div class="value price">$${finalTotal.toFixed(2)}</div></div>
    </div>
    ${hasExtra ? `
      <div class="divider"></div>
      <div class="breakdown">
        ${surcharge>0 ? `<div class="row"><span>Distance Surcharge</span><span>$${surcharge.toFixed(2)}</span></div>` : ``}
        ${ahFee>0 ? `<div class="row"><span>After-Hours Fee (20%) ‚Äì Regular Hours: 6:00 am to 11:00 pm</span><span>$${ahFee.toFixed(2)}</span></div>` : ``}
        <div class="divider"></div>
        <div class="row total"><span>Total</span><span>$${finalTotal.toFixed(2)}</span></div>
      </div>
    ` : ``}
  `;

  window.__lastQuotedTotal = finalTotal;
  window.__lastDistanceMiles = miles;
  window.__vehicleType = selectedVehicle;
  syncButtons();
}

/* ===== Init Google Maps ===== */
function initMap(){
  map = new google.maps.Map(document.getElementById("map"), { center:{lat:40.7587,lng:-111.8762}, zoom:10 });
  directionsService  = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer();
  directionsRenderer.setMap(map);
  geocoder = new google.maps.Geocoder();
  const opts = { componentRestrictions:{country:["us"]}, fields:["place_id","name","types","formatted_address","geometry","address_components"] };
  const acPickup  = new google.maps.places.Autocomplete(document.getElementById("pickup"), opts);
  const acDropoff = new google.maps.places.Autocomplete(document.getElementById("dropoff"), opts);
  acPickup.addListener("place_changed", ()=>{ pickupPlace = acPickup.getPlace() || null; updateFlightVisibility(); });
  acDropoff.addListener("place_changed", ()=>{ dropoffPlace = acDropoff.getPlace() || null; });
}
window.initMap = initMap;

/* ===== Modal Read More ===== */
(function wireModalReadMore(){
  const content = document.getElementById('modal-terms-content');
  const btn = document.getElementById('modalReadMoreBtn');
  if(!content || !btn) return;
  btn.addEventListener('click', ()=>{
    const clamped = content.classList.toggle('clamped');
    const expanded = !clamped;
    btn.textContent = expanded ? 'Read Less' : 'Read More';
    btn.setAttribute('aria-expanded', String(expanded));
  });
})();

/* ===== Terms + buttons ===== */
const acceptPill  = document.getElementById('acceptPill');
const calcBtn = document.getElementById('calculate');
const payBtn = document.getElementById('pay');

function setAcceptedState(on){
  if(!acceptPill) return;
  acceptPill.classList.toggle('on', on);
  acceptPill.setAttribute('aria-checked', on ? 'true' : 'false');
  syncButtons();
}
function isAccepted(){ return acceptPill?.classList.contains('on'); }
function syncButtons(){
  const accepted = isAccepted();
  if(calcBtn) calcBtn.disabled = !accepted;
  const readyPay = !!window.__lastQuotedTotal && accepted;
  if(payBtn){
    payBtn.disabled = !readyPay;
    payBtn.style.display = 'block';
    payBtn.style.opacity = readyPay ? 1 : .5;
    payBtn.style.cursor = readyPay ? 'pointer' : 'not-allowed';
  }
}
acceptPill?.addEventListener('click', ()=> setAcceptedState(!isAccepted()));
acceptPill?.addEventListener('keydown', (e)=>{ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); setAcceptedState(!isAccepted()); }});
    <!-- index.html ‚Äî Parte 9/9 -->
/* ===== Validaci√≥n elegante antes de calcular o pagar ===== */
function requireAllOrAlert(){
  const fieldsAlways = ['fullname','phone','email','pickup','dropoff','date','time'];
  const flightWrap = document.getElementById('flightContainer');
  const pvtWrap    = document.getElementById('privateFlightContainer');
  if(flightWrap && flightWrap.style.display!=='none'){
    fieldsAlways.push('flightNumber','flightOrigin');
  }
  if(pvtWrap && pvtWrap.style.display!=='none'){
    fieldsAlways.push('tailNumber','pvtOrigin');
  }
  if(!isAccepted()){
    showToast("Please accept the Terms & Conditions to continue.");
    return false;
  }
  for(const id of fieldsAlways){
    const el = document.getElementById(id);
    if(el && !el.checkValidity()){
      el.reportValidity();
      showToast("Please complete all required fields before continuing.");
      el.scrollIntoView({behavior:'smooth', block:'center'});
      el.focus({preventScroll:true});
      return false;
    }
  }
  return true;
}

/* ===== Toast elegante ===== */
function showToast(msg){
  let toast = document.getElementById('toast');
  if(!toast){
    toast = document.createElement('div');
    toast.id = 'toast';
    toast.style.position = 'fixed';
    toast.style.bottom = '20px';
    toast.style.left = '50%';
    toast.style.transform = 'translateX(-50%)';
    toast.style.background = 'rgba(0,0,0,0.85)';
    toast.style.color = '#fff';
    toast.style.padding = '10px 20px';
    toast.style.borderRadius = '6px';
    toast.style.zIndex = '9999';
    toast.style.fontSize = '15px';
    toast.style.maxWidth = '80%';
    toast.style.textAlign = 'center';
    toast.style.boxShadow = '0 2px 6px rgba(0,0,0,0.3)';
    document.body.appendChild(toast);
  }
  toast.textContent = msg;
  toast.style.opacity = '1';
  setTimeout(()=>{ toast.style.opacity = '0'; }, 4000);
}

/* ===== Bot√≥n Calculate ===== */
calcBtn?.addEventListener('click', async ()=>{
  if(!requireAllOrAlert()) return;
  if(!pickupPlace || !dropoffPlace){
    showToast("Please select addresses from the suggestions.");
    return;
  }
  try{
    const mi = await computeMilesFromBase(dropoffPlace.place_id);
    const base = calculateBase(mi);
    const dropCounty = await countyByPlaceId(dropoffPlace.place_id);
    const surcharge = (!/summit|wasatch/i.test(dropCounty)) ? 50 : 0;
    const afterH = isAfterHours(document.getElementById('date').value, document.getElementById('time').value);
    const r = await routeAsync({origin:pickupPlace.place_id,destination:dropoffPlace.place_id,travelMode:google.maps.TravelMode.DRIVING});
    renderInfo(r.routes[0].legs[0], base, surcharge, afterH);
  }catch(err){
    console.error(err);
    showToast("Unable to calculate route. Please check addresses.");
  }
});

/* ===== Bot√≥n PAY NOW ===== */
payBtn?.addEventListener('click', async ()=>{
  if(!requireAllOrAlert()) return;
  if(!window.__lastQuotedTotal){
    showToast("Please calculate the price before paying.");
    return;
  }
  try{
    const res = await fetch('/api/create-checkout-session', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        amount: Math.round(window.__lastQuotedTotal * 100),
        vehicleType: window.__vehicleType || 'suv',
        distance: window.__lastDistanceMiles || 0
      })
    });
    const data = await res.json();
    if(data?.url){
      window.location.href = data.url;
    }else{
      showToast("Payment session could not be created.");
    }
  }catch(err){
    console.error(err);
    showToast("Payment error. Please try again.");
  }
});

/* ===== Init ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  mountDateTime();
  wireFlightValidation();
  updateFlightVisibility();
  syncButtons();
});
  </script>
</body>
</html>
