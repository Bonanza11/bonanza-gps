<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bonanza Transportation</title>

  <style>
    :root{ --copper:#a8744f; --ok:#17c964; --warn:#ffcc66; --err:#ff6b6b; }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:#000;color:var(--copper);font-family:Arial,sans-serif}

    /* Header / Logo */
    header{display:flex;justify-content:center;align-items:center;padding:20px 16px}
    .logo-wrap{ position:relative }
    .logo{
      width:180px;height:180px;border-radius:50%;border:2px solid var(--copper);
      object-fit:cover;display:block;position:relative;
      box-shadow:0 0 2px rgba(192,139,92,.35) inset,0 0 8px rgba(0,0,0,.6),0 0 10px rgba(192,139,92,.45);
      filter: drop-shadow(0 0 5px rgba(192,139,92,.45));
    }
    .logo-wrap::after{content:"";position:absolute;inset:-8px;border-radius:50%;box-shadow:0 0 22px 10px rgba(192,139,92,.35);pointer-events:none;}

    /* Layout */
    main{max-width:760px;width:92vw;margin:0 auto 40px;padding:0 16px}
    label{display:block;margin:12px 0 6px;font-weight:700}

    /* Inputs */
    input,select{
      display:block;width:100%;height:44px;padding:10px 12px;
      background:#1a1a1a;color:var(--copper);border:1px solid #444;border-radius:8px;
      outline:none;
    }
    input:focus,select:focus{border-color:var(--copper);box-shadow:0 0 0 3px rgba(168,116,79,.18)}
    ::placeholder{color:#cba686;opacity:.65}

    /* Autofill */
    input:-webkit-autofill,
    input:-webkit-autofill:focus{
      -webkit-text-fill-color: var(--copper);
      transition: background-color 50000s ease-in-out 0s;
      box-shadow: 0 0 0 1000px #1a1a1a inset;
      border:1px solid #444;
    }

    button{
      width:100%;padding:14px 16px;margin-top:18px;background:var(--copper);color:#000;
      font-weight:700;font-size:18px;border:0;border-radius:10px;cursor:pointer;
      animation:pulse 2.5s infinite ease-in-out;
    }
    button:disabled{opacity:0.5;cursor:not-allowed;}
    @keyframes pulse{
      0%{transform:scale(1); box-shadow:0 0 0 0 rgba(192,139,92,.5)}
      50%{transform:scale(1.02); box-shadow:0 0 0 8px rgba(192,139,92,0)}
      100%{transform:scale(1); box-shadow:0 0 0 0 rgba(192,139,92,0)}
    }
    #map{height:380px;margin-top:10px;border-radius:12px;overflow:hidden}

    /* Trip Summary */
    #info{
      display:none;margin-top:18px;border-radius:16px;padding:18px;
      background:linear-gradient(180deg,#121212,#0b0b0b);
      border:1px solid rgba(192,139,92,.28);box-shadow:0 18px 40px rgba(0,0,0,.55);
      color:#e9d5c1;font-size:.95em;
    }

    /* Vehicle visual */
    .turntable{margin:10px 0 6px; display:flex; flex-direction:column; align-items:center;}
    .turntable .car{width:260px;height:auto;filter:drop-shadow(0 12px 18px rgba(0,0,0,.6))}
    .turntable .platform{
      width:220px;height:22px;border-radius:50%;
      background:radial-gradient(ellipse at center, rgba(0,0,0,.7) 0%, rgba(0,0,0,.25) 60%, rgba(0,0,0,0) 70%);
      margin-top:6px;
    }
    .vehicle-caption{font-weight:700;color:#ffddae;margin-top:6px;letter-spacing:.2px;}

    /* Luggage guide styling */
    .helper ul {
      margin: 6px 0 12px;
      padding-left: 20px;
      list-style-type: disc;
    }
    .helper strong {
      color: var(--copper);
      font-size: 1rem;
    }
    .helper em {
      color: #ffddae;
      font-style: normal;
      font-weight: 600;
      display: block;
      margin-top: 4px;
    }
  </style>
</head>
<body>
    <header>
    <div class="logo-wrap">
      <img class="logo" src="/images/bonanza-logo.PNG" alt="Bonanza Transportation Logo">
    </div>
  </header>

  <main>
    <label for="fullname">Full Name:</label>
    <input id="fullname" type="text" placeholder="e.g. John Doe" autocomplete="name" required />

    <label for="phone">Phone Number (US):</label>
    <input id="phone" type="tel" inputmode="numeric" autocomplete="tel" placeholder="(555) 123-4567" required />
    <div id="phoneHelp" class="hint"></div>

    <label for="email">Email Address:</label>
    <input id="email" type="email" placeholder="you@example.com" autocomplete="email" required />
    <div id="emailHelp" class="hint"></div>

    <label for="pickup">Pick-up Address:</label>
    <input id="pickup" placeholder="e.g. SLC Airport" required />

    <label for="dropoff">Drop-off Address:</label>
    <input id="dropoff" placeholder="e.g. Montage Deer Valley" required />

    <!-- Flight info (hidden until needed) -->
    <div id="flightContainer" style="display:none;">
      <label for="flightNumber">Flight Number:</label>
      <input id="flightNumber" placeholder="e.g. DL1234" />
      <div id="flightHint" class="hint warn" style="display:none">
        ✈️ Enter the complete flight number exactly as it appears on your boarding pass or itinerary.
      </div>

      <label for="flightOrigin" style="margin-top:12px;">Flight Origin City:</label>
      <input id="flightOrigin" placeholder="e.g. Miami (MIA)" />
      <div id="originHelp" class="hint" style="display:none"></div>
    </div>

    <!-- Date & Time -->
    <div class="input-row">
      <div>
        <label for="date">Date:</label>
        <input id="date" type="date" />
        <div id="dateHelp" class="helper"></div>
      </div>
      <div>
        <label for="time">Time:</label>
        <input id="time" type="time" step="900" />
        <div id="timeHelp" class="helper"></div>
      </div>
    </div>

    <!-- Vehicle selector -->
    <label>Vehicle Type:</label>
    <div class="veh-toggle">
      <button type="button" class="veh-btn active" data-type="suv" aria-pressed="true">
        SUV – 1 to 5 Passengers
      </button>
      <button type="button" class="veh-btn" data-type="van" aria-pressed="false">
        Van – Up to 12 Passengers
      </button>
    </div>

    <!-- Vehicle display -->
    <div class="turntable">
      <img id="vehicle-photo" class="car" src="/images/suburban.png" alt="Vehicle">
      <div class="platform"></div>
      <div id="vehicle-caption" class="vehicle-caption">This will be your SUV</div>
    </div>

    <!-- SUV luggage guide -->
    <div id="suv-luggage" class="helper">
      <strong>SUV – Capacity</strong>
      <em>Option 1 – With Sports Equipment (ski or golf bags)</em>
      <ul>
        <li>5 sports equipment items</li>
        <li>3 large suitcases (28–32”)</li>
        <li>3 small suitcases (20–24”)</li>
      </ul>
      <em>Option 2 – Without Sports Equipment</em>
      <ul>
        <li>4 large suitcases (28–32”)</li>
        <li>4 small suitcases (20–24”)</li>
      </ul>
    </div>

    <!-- Van luggage guide -->
    <div id="van-luggage" class="helper" style="display:none">
      <strong>Van – Capacity</strong>
      <em>Option 1 – With Sports Equipment (ski or golf bags)</em>
      <ul>
        <li>8 sports equipment items</li>
        <li>8 large suitcases (28–32”)</li>
        <li>Carry-on: 1 per passenger</li>
      </ul>
      <em>Option 2 – Without Sports Equipment</em>
      <ul>
        <li>12–14 large suitcases (28–32”)</li>
        <li>Carry-on: 1 per passenger</li>
      </ul>
    </div>

    <!-- Terms -->
    <div class="terms-box" id="terms-box">
      <div class="terms-summary">
        <div class="accept-pill" id="acceptPill" tabindex="0" role="switch" aria-checked="false">
          <div class="accept-dot"></div>
        </div>
        <div class="accept-label">I accept the Terms & Conditions</div>
        <div class="chev"></div>
      </div>
      <div class="terms-body">
        <div id="terms-content" class="terms-content clamped">
          By booking with Bonanza Transportation, you agree to our policies including but not limited to payment terms,
          cancellation policy, and liability limits. Please read carefully before proceeding. Bonanza Transportation
          reserves the right to modify or cancel reservations if conditions warrant. Full terms are available upon request.
        </div>
        <button type="button" id="readMoreBtn" class="readmore-btn" aria-expanded="false">Read More</button>
      </div>
    </div>

    <!-- Buttons -->
    <button id="calculate" disabled>Calculate Price</button>
    <button id="pay" disabled style="display:none">PAY NOW</button>

    <!-- Google Map -->
    <div id="map"></div>

    <!-- Trip Summary -->
    <div id="info"></div>
  </main>
    <script>
/* ===== Config ===== */
const SUV_IMG = "/images/suburban.png";
const VAN_IMG = "/images/van-sprinter.png";

/* ===== Globals ===== */
let map, directionsService, directionsRenderer, geocoder;
const BASE_ADDRESS = "13742 N Jordanelle Pkwy, Kamas, UT";
let pickupPlace = null, dropoffPlace = null;
let selectedVehicle = 'suv';

/* ===== Operating hours (6:00–23:00) ===== */
const OPERATING_START = "06:00";
const OPERATING_END   = "23:00";

/* ===== Pricing (tabla oficial) ===== */
function calculateBase(mi){
  if (mi <= 10) return 120;
  if (mi <= 35) return 190;
  if (mi <= 39) return 210;
  if (mi <= 48) return 230;
  if (mi <= 55) return 250;
  return mi * 5.4;
}
function applyVehicleMultiplier(total){
  return (selectedVehicle === 'van') ? Math.round(total * 1.30) : total;
}
function recalcFromCache(){
  const el = document.getElementById('info');
  if (!el || window.__lastBase == null) return;
  const base = window.__lastBase, surcharge = window.__lastSurcharge||0, ahFee = window.__lastAhFee||0;
  const finalTotal = applyVehicleMultiplier(base + surcharge + ahFee);
  const priceEl = el.querySelector('.kpi .value.price');
  const totalEl = el.querySelector('.row.total span:last-child');
  if (priceEl) priceEl.textContent = `$${finalTotal.toFixed(2)}`;
  if (totalEl) totalEl.textContent = `$${finalTotal.toFixed(2)}`;
  window.__lastQuotedTotal = finalTotal;
  window.__vehicleType = selectedVehicle;
}

/* ===== Time helpers ===== */
function nextQuarter(d){ const m=d.getMinutes(); const add=15-(m%15||15); d.setMinutes(m+add,0,0); return d; }
function localISODate(d){ const off=d.getTimezoneOffset()*60000; return new Date(d-off).toISOString().slice(0,10); }
function setTimeValue(el,h,m){ if(el) el.value = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`; }
function isAfterHours(dateStr, timeStr){
  if(!dateStr || !timeStr) return false;
  const d = new Date(`${dateStr}T${timeStr}:00`);
  const [sh,sm] = OPERATING_START.split(':').map(Number);
  const [eh,em] = OPERATING_END.split(':').map(Number);
  const start = new Date(d); start.setHours(sh, sm, 0, 0);
  const end   = new Date(d); end.setHours(eh, em, 0, 0);
  return (d < start) || (d > end);
}
function mountDateTime(){
  const dateEl = document.getElementById('date');
  const timeEl = document.getElementById('time');
  const dateHelp = document.getElementById('dateHelp');
  const timeHelp = document.getElementById('timeHelp');
  const nx = nextQuarter(new Date());
  if(dateEl && !dateEl.value) dateEl.value = localISODate(nx);
  if(timeEl && !timeEl.value) setTimeValue(timeEl, nx.getHours(), nx.getMinutes());
  if(dateEl) dateEl.min = localISODate(new Date());
  function update(){
    if(dateHelp && dateEl?.value){
      const d = new Date(dateEl.value + 'T00:00:00');
      dateHelp.textContent = `Selected: ${d.toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'})}`;
    }
    if(timeHelp && timeEl?.value){ timeHelp.textContent = `Selected: ${timeEl.value}`; }
  }
  dateEl?.addEventListener('change', update);
  timeEl?.addEventListener('change', update);
  update();
}

/* ===== Google Places helpers ===== */
function isAirport(place){
  const t = place?.types || [];
  return t.includes("airport") || /airport/i.test(place?.name || place?.formatted_address || "");
}
function isUtah(place){
  const addr=(place?.formatted_address||'').toLowerCase();
  return /\but\b/.test(addr) || /, ut(ah)?\b/.test(addr);
}
function pickupIsUtahAirport(){ return pickupPlace && isAirport(pickupPlace) && isUtah(pickupPlace); }
function countyFrom(place){
  const comps=place?.address_components||[];
  const c=comps.find(x=>x.types?.includes("administrative_area_level_2"));
  return c?.long_name||"";
}
function routeAsync(opts){ return new Promise((res,rej)=>{ directionsService.route(opts,(r,s)=> s==="OK"&&r?res(r):rej(s||"ROUTE_ERROR")); }); }
function geocodeAsync(req){ return new Promise((res,rej)=>{ geocoder.geocode(req,(results,status)=>{ if(status==="OK"&&results?.[0]) res(results[0]); else rej(status||"GEOCODE_ERROR"); }); }); }
async function countyByPlaceId(placeId){ try{ const r=await geocodeAsync({placeId}); const c=r.address_components.find(c=>c.types.includes("administrative_area_level_2")); return c?.long_name||""; }catch(_){ return ""; } }
async function computeMilesFromBase(placeId){ const r=await routeAsync({origin:BASE_ADDRESS,destination:{placeId},travelMode:google.maps.TravelMode.DRIVING}); return r.routes[0].legs[0].distance.value/1609.34; }

/* ===== Vehicle selector with luggage guide toggle ===== */
(function wireVehicleSelector(){
  const suvBtn = document.querySelector('.veh-btn[data-type="suv"]');
  const vanBtn = document.querySelector('.veh-btn[data-type="van"]');
  const suvGuide = document.getElementById('suv-luggage');
  const vanGuide = document.getElementById('van-luggage');
  const photo = document.getElementById('vehicle-photo');
  const caption = document.getElementById('vehicle-caption');

  function setVehicle(type){
    selectedVehicle = type;
    [suvBtn,vanBtn].forEach(b=>{
      const on = b && b.dataset.type===type;
      if(!b) return;
      b.classList.toggle('active', on);
      b.setAttribute('aria-pressed', String(on));
    });
    const isVan = (type==='van');
    if(vanGuide) vanGuide.style.display = isVan ? 'block' : 'none';
    if(suvGuide) suvGuide.style.display = isVan ? 'none' : 'block';
    if(photo) photo.src = isVan ? VAN_IMG : SUV_IMG;
    if(caption) caption.textContent = isVan ? 'This will be your Van' : 'This will be your SUV';
    recalcFromCache();
  }
  suvBtn?.addEventListener('click', ()=> setVehicle('suv'));
  vanBtn?.addEventListener('click', ()=> setVehicle('van'));
  setVehicle('suv');
})();
      /* ===== Terms: Read More ===== */
(function wireReadMore(){
  const content = document.getElementById('terms-content');
  const btn = document.getElementById('readMoreBtn');
  if(!content || !btn) return;
  btn.addEventListener('click', ()=>{
    const clamped = content.classList.toggle('clamped');
    const expanded = !clamped;
    btn.textContent = expanded ? 'Read Less' : 'Read More';
    btn.setAttribute('aria-expanded', String(expanded));
  });
})();

/* ===== Accept Terms ===== */
const acceptPill  = document.getElementById('acceptPill');
const calcBtn = document.getElementById('calculate');
const payBtn = document.getElementById('pay');

function setAcceptedState(on){
  acceptPill.classList.toggle('on', on);
  acceptPill.setAttribute('aria-checked', on ? 'true' : 'false');
  syncButtons();
}
function isAccepted(){ return acceptPill?.classList.contains('on'); }
function syncButtons(){
  const accepted = isAccepted();
  if(calcBtn) calcBtn.disabled = !accepted;
  const readyPay = !!window.__lastQuotedTotal && accepted;
  if(payBtn){
    payBtn.disabled = !readyPay;
    payBtn.style.display = 'block';
    payBtn.style.opacity = readyPay ? 1 : .5;
    payBtn.style.cursor = readyPay ? 'pointer' : 'not-allowed';
  }
}
acceptPill?.addEventListener('click', ()=> setAcceptedState(!isAccepted()));
acceptPill?.addEventListener('keydown', (e)=>{ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); setAcceptedState(!isAccepted()); }});

/* ===== Email validation ===== */
(function wireEmail(){
  const input = document.getElementById('email');
  const help  = document.getElementById('emailHelp');
  if(!input) return;

  function validateEmail(v){
    const val = (v||'').trim();
    const basic = /^[^\s@]+@[^\s@]+\.[^\s@]{2,24}$/.test(val);
    if(!basic) return {ok:false,msg:'Please enter a valid email, e.g., name@domain.com'};
    if(/\.\./.test(val)) return {ok:false,msg:'Email cannot contain consecutive dots'};
    const typos = [/@gmal\.com$/i, /@gmial\.com$/i, /@hotnail\.com$/i, /@yaho\.com$/i];
    if(typos.some(rx=>rx.test(val))) return {ok:false,msg:'Please correct the domain spelling (e.g., @gmail.com)'};
    return {ok:true,msg:'Email looks good'};
  }

  input.addEventListener('input', ()=>{
    const r = validateEmail(input.value);
    input.setCustomValidity(r.ok ? '' : r.msg);
    if(help){
      help.textContent = r.ok ? 'Valid email' : r.msg;
      help.className = 'hint ' + (r.ok ? 'ok' : 'err');
    }
  });
})();

/* ===== US Phone validation ===== */
(function wirePhone(){
  const input = document.getElementById('phone');
  const help  = document.getElementById('phoneHelp');
  if(!input) return;

  function formatUS(digits){
    if(digits.startsWith('1')) digits = digits.slice(1);
    digits = digits.slice(0,10);
    const a = digits.slice(0,3), b = digits.slice(3,6), c = digits.slice(6,10);
    if(digits.length > 6) return `(${a}) ${b}-${c}`;
    if(digits.length > 3) return `(${a}) ${b}`;
    if(digits.length > 0) return `(${a}`;
    return '';
  }
  function validateNANP(digits){
    if(digits.length===11 && digits.startsWith('1')) digits = digits.slice(1);
    if(digits.length!==10) return {ok:false,msg:'Enter a 10-digit US number'};
    if(!/^[2-9]/.test(digits[0])) return {ok:false,msg:'Area code must start 2–9'};
    if(!/^[2-9]/.test(digits[3])) return {ok:false,msg:'Exchange must start 2–9'};
    return {ok:true,msg:'Valid US number'};
  }

  input.addEventListener('input', ()=>{
    const digits = input.value.replace(/\D/g,'').slice(0,11);
    input.value = formatUS(digits);
    const v = validateNANP(digits);
    input.setCustomValidity(v.ok ? '' : v.msg);
    if(help){
      help.textContent = v.ok ? 'Valid US number' : v.msg;
      help.className = 'hint ' + (v.ok ? 'ok' : 'err');
    }
  });
})();

/* ===== Calculate Price ===== */
calcBtn?.addEventListener("click", async ()=>{
  if (!isAccepted()){
    alert("Please accept Terms & Conditions first.");
    return;
  }
  if (!pickupPlace?.place_id || !dropoffPlace?.place_id){
    alert("Please select addresses from the suggestions.");
    return;
  }
  try{
    const trip = await routeAsync({
      origin:{placeId: pickupPlace.place_id},
      destination:{placeId: dropoffPlace.place_id},
      travelMode: google.maps.TravelMode.DRIVING
    });
    directionsRenderer.setDirections(trip);
    const leg = trip.routes[0].legs[0];
    const miles = leg.distance.value/1609.34;
    const basePrice = calculateBase(miles);
    let surcharge = 0;

    const pickupAir = isAirport(pickupPlace);
    let pickupCounty = countyFrom(pickupPlace) || await countyByPlaceId(pickupPlace.place_id);
    let dropCounty   = countyFrom(dropoffPlace) || await countyByPlaceId(dropoffPlace.place_id);
    const pickupAllowed = /Summit County|Wasatch County/.test(pickupCounty||"");
    const dropAllowed   = /Summit County|Wasatch County/.test(dropCounty||"");

    if (pickupAir){
      if (!dropAllowed){ const m = await computeMilesFromBase(pickupPlace.place_id); surcharge = m * 3; }
    }else{
      if (!pickupAllowed){ const m = await computeMilesFromBase(pickupPlace.place_id); surcharge = m * 3; }
    }

    const afterHours = isAfterHours(document.getElementById("date").value, document.getElementById("time").value);
    renderInfo(leg, basePrice, surcharge, afterHours);
    payBtn.style.display = "block";
    syncButtons();
  }catch(err){
    alert("Could not calculate route: " + err);
  }
});

/* ===== PAY (stub) ===== */
function generateConfirmationNumber(){
  const d=new Date(), y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), day=String(d.getDate()).padStart(2,'0');
  const rand=Math.random().toString(36).slice(2,6).toUpperCase();
  return `BZ-${y}${m}${day}-${rand}`;
}
payBtn?.addEventListener('click', async ()=>{
  if(!isAccepted()){ alert('Please accept Terms to proceed.'); return; }
  const payload = {
    fullname: document.getElementById('fullname').value,
    phone: document.getElementById('phone').value,
    email: document.getElementById('email').value,
    pickup: document.getElementById('pickup').value,
    dropoff: document.getElementById('dropoff').value,
    date: document.getElementById('date').value,
    time: document.getElementById('time').value,
    flightNumber: document.getElementById('flightNumber').value || null,
    flightOriginCity: document.getElementById('flightOrigin').value || null,
    vehicleType: window.__vehicleType || selectedVehicle || 'suv',
    distanceMiles: window.__lastDistanceMiles || null,
    quotedTotal: window.__lastQuotedTotal || null,
    confirmationNumber: generateConfirmationNumber(),
    acceptedTermsAt: new Date().toISOString()
  };
  console.log('PAYLOAD →', payload);
  alert(`Your confirmation number is ${payload.confirmationNumber}`);
});

/* ===== On load ===== */
mountDateTime();
syncButtons();

/* ===== Google Maps Init ===== */
function initMap(){
  map = new google.maps.Map(document.getElementById("map"), { center:{lat:40.7587,lng:-111.8762}, zoom:10 });
  directionsService  = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer();
  directionsRenderer.setMap(map);
  geocoder = new google.maps.Geocoder();
  const opts = { componentRestrictions:{country:["us"]}, fields:["place_id","name","types","formatted_address","geometry","address_components"] };
  const acPickup  = new google.maps.places.Autocomplete(document.getElementById("pickup"), opts);
  const acDropoff = new google.maps.places.Autocomplete(document.getElementById("dropoff"), opts);
  acPickup.addListener("place_changed", ()=>{ pickupPlace = acPickup.getPlace() || null; });
  acDropoff.addListener("place_changed", ()=>{ dropoffPlace = acDropoff.getPlace() || null; });
}
window.initMap = initMap;
  </script>

  <!-- Google Maps loader -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDN6B8izVVhi9CGiO-_TXdhquQAE_i5Lts&libraries=places&callback=initMap" async defer></script>
</body>
</html>
