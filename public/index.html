<!-- index.html — Parte 1/9 (corregido, base intacta) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bonanza Transportation</title>

  <style>
    :root{ --copper:#a8744f; --ok:#17c964; --warn:#ffcc66; --err:#ff6b6b; }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:#000;color:var(--copper);font-family:Arial,sans-serif}

    /* Header / Logo */
    header{display:flex;justify-content:center;align-items:center;padding:20px 16px}
    .logo-wrap{ position:relative }
    .logo{
      width:180px;height:180px;border-radius:50%;border:2px solid var(--copper);
      object-fit:cover;display:block;position:relative;
      box-shadow:0 0 2px rgba(192,139,92,.35) inset,0 0 8px rgba(0,0,0,.6),0 0 10px rgba(192,139,92,.45);
      filter: drop-shadow(0 0 5px rgba(192,139,92,.45));
    }
    .logo-wrap::after{content:"";position:absolute;inset:-8px;border-radius:50%;box-shadow:0 0 22px 10px rgba(192,139,92,.35);pointer-events:none;}

    /* Layout */
    main{max-width:760px;width:92vw;margin:0 auto 40px;padding:0 16px}
    label{display:block;margin:12px 0 6px;font-weight:700}

    /* Inputs: oscuros en todos (incl. autofill) */
    input,select{
      display:block;width:100%;height:44px;padding:10px 12px;
      background:#1a1a1a;color:var(--copper);border:1px solid #444;border-radius:8px;
      outline:none;
    }
    input:focus,select:focus{border-color:var(--copper);box-shadow:0 0 0 3px rgba(168,116,79,.18)}
    ::placeholder{color:#cba686;opacity:.65}

    /* Fuerza oscuro también cuando el navegador autocompleta */
    input:-webkit-autofill,
    input:-webkit-autofill:focus{
      -webkit-text-fill-color: var(--copper);
      transition: background-color 50000s ease-in-out 0s;
      box-shadow: 0 0 0 1000px #1a1a1a inset;
      border:1px solid #444;
    }

    button{
      width:100%;padding:14px 16px;margin-top:18px;background:var(--copper);color:#000;
      font-weight:700;font-size:18px;border:0;border-radius:10px;cursor:pointer;
    }
    button:disabled{opacity:0.5;cursor:not-allowed;}
    
    #map{height:380px;margin-top:10px;border-radius:12px;overflow:hidden}

    /* Trip Summary */
    #info{
      display:none;margin-top:18px;border-radius:16px;padding:18px;
      background:linear-gradient(180deg,#121212,#0b0b0b);
      border:1px solid rgba(192,139,92,.28);box-shadow:0 18px 40px rgba(0,0,0,.55);
      color:#e9d5c1;font-size:.95em;
    }
    .info-title{font-weight:800;margin:0 0 4px;font-size:1.05rem}
    .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:10px 0 12px;}
    .kpi{background:#0e0e0e;border:1px solid rgba(192,139,92,.18);border-radius:12px;padding:12px;}
    .kpi .label{font-size:.75rem;opacity:.8;margin-bottom:6px}
    .kpi .value{font-size:1.35rem;font-weight:800;color:#f0d1ad}
    .kpi .unit{font-size:.9rem;opacity:.7;margin-left:4px}
    .kpi .value.price{color:#ffddae}
    .breakdown{margin:6px 0 12px;}
    .breakdown .row{display:flex;justify-content:space-between;padding:6px 0;}
    .breakdown .row.total{font-weight:800;color:#ffddae;font-size:1.05rem}
    .divider{height:1px;background:linear-gradient(90deg,transparent,rgba(192,139,92,.35),transparent);margin:6px 0}

    /* Date/Time */
    .input-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media (max-width:520px){.input-row{grid-template-columns:1fr;}}
    #date,#time{
      height:56px;font-size:17px;border-radius:12px;background:#1f1f1f;color:#fff;
      border:2px solid var(--copper);box-shadow:0 0 0 3px rgba(168,116,79,.18);
    }
    #date:focus,#time:focus{outline:none;border-color:#ffd9a1;box-shadow:0 0 0 4px rgba(255,217,161,.22);}
    input[type="date"]::-webkit-calendar-picker-indicator,
    input[type="time"]::-webkit-calendar-picker-indicator{
      filter:invert(80%) sepia(20%) saturate(180%) hue-rotate(340deg) brightness(110%);
      opacity:.95;cursor:pointer;
    }
    .helper{font-size:.85rem;opacity:.95;margin-top:6px;color:#ffddae;}

    /* Vehicle visual */
    .turntable{margin:10px 0 6px; display:flex; flex-direction:column; align-items:center;}
    .turntable .car{width:260px;height:auto;filter:drop-shadow(0 12px 18px rgba(0,0,0,.6))}
    .turntable .platform{
      width:220px;height:22px;border-radius:50%;
      background:radial-gradient(ellipse at center, rgba(0,0,0,.7) 0%, rgba(0,0,0,.25) 60%, rgba(0,0,0,0) 70%);
      margin-top:6px;
    }
    .vehicle-caption{font-weight:700;color:#ffddae;margin-top:6px;letter-spacing:.2px;}

    /* Vehicle selector */
    .veh-toggle{display:flex;gap:8px;margin:10px 0}
    .veh-btn{
      flex:1 1 0;background:#1a1a1a;border:1px solid rgba(168,116,79,.55);
      color:var(--copper);padding:12px;border-radius:10px;cursor:pointer;font-weight:700
    }
    .veh-btn.active{
      background:var(--copper);color:#000;border-color:var(--copper);
      box-shadow:0 0 0 3px rgba(168,116,79,.25)
    }

    /* Terms compact box */
    .terms-box{border:1px solid rgba(168,116,79,.45);border-radius:12px;padding:10px 12px;margin-top:10px;background:#0e0e0e}
    .terms-summary{
      display:flex;align-items:center;gap:10px;cursor:pointer;
    }
    .terms-summary .chev{
      width:10px;height:10px;border-right:2px solid var(--copper);
      border-bottom:2px solid var(--copper);transform:rotate(-45deg);transition:.2s;margin-left:auto;
    }
    .terms-box.open .terms-summary .chev{transform:rotate(45deg)}

    /* Switch (único) */
    .accept-pill{
      min-width:28px;height:20px;border-radius:999px;border:1px solid #666;
      display:flex;align-items:center;padding:0 2px;position:relative;background:#1a1a1a;
    }
    .accept-dot{
      width:14px;height:14px;border-radius:50%;background:#333;transition:.2s;
      border:1px solid #555;
    }
    .accept-pill.on{border-color:var(--ok);background:rgba(23,201,100,.12)}
    .accept-pill.on .accept-dot{transform:translateX(8px);background:var(--ok);border-color:var(--ok)}
    .accept-label{font-size:.85rem;opacity:.9;margin-left:8px}

    /* Read-more (2 líneas + degradado) */
    .terms-body{margin-top:10px;color:#e9d5c1;font-size:.95rem;line-height:1.55}
    .terms-content.clamped{
      display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;
      overflow:hidden;position:relative;
    }
    .terms-content.clamped::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:2.2em;
      background:linear-gradient(180deg, rgba(14,14,14,0), rgba(14,14,14,1));
      pointer-events:none;
    }
    .readmore-btn{
      display:inline-block;margin-top:8px;padding:6px 10px;border:1px solid rgba(168,116,79,.55);
      border-radius:8px;background:#1a1a1a;color:#ffddae;font-weight:700;font-size:.85rem;cursor:pointer;
    }

    /* Hints */
    .hint{font-size:.85rem;margin-top:6px}
    .hint.warn{color:var(--warn)}
    .hint.err{color:var(--err)}
    .hint.ok{color:var(--ok)}

    /* Luggage Accordion */
    .luggage-accordion{border:1px solid rgba(168,116,79,.45);border-radius:12px;padding:10px 12px;margin-top:10px;background:#0e0e0e}
    .luggage-summary{display:flex;align-items:center;gap:10px;cursor:pointer}
    .luggage-title{font-weight:700}
    .luggage-chev{width:10px;height:10px;border-right:2px solid var(--copper);border-bottom:2px solid var(--copper);transform:rotate(-45deg);transition:.2s;margin-left:auto}
    .luggage-accordion.open .luggage-chev{transform:rotate(45deg)}
    .luggage-body{display:none;margin-top:10px;color:#e9d5c1;font-size:.95rem;line-height:1.55}
    .luggage-accordion.open .luggage-body{display:block}
    .lug-section h4{margin:6px 0 4px;color:#ffddae}
    .lug-note{opacity:.9;margin:2px 0 8px}
    .lug-list{margin:0 0 10px 18px}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;display:none;background:rgba(0,0,0,.74);align-items:center;justify-content:center;padding:16px;z-index:9999}
    .modal-backdrop.open{display:flex}
    .modal{max-width:860px;width:100%;max-height:86vh;background:#0e0e0e;border:1px solid rgba(168,116,79,.45);border-radius:12px;box-shadow:0 18px 48px rgba(0,0,0,.7);overflow:hidden;display:flex;flex-direction:column}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid rgba(168,116,79,.28);background:#101010}
    .modal-title{font-weight:800;color:#ffddae}
    .modal-body{padding:14px 16px 18px;overflow:auto;color:#e9d5c1;line-height:1.6}
    .close-btn{background:#1a1a1a;border:1px solid rgba(168,116,79,.45);color:#ffddae;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:700}
  </style>
</head>
<!-- index.html — Parte 2/9 -->
<body>
  <header>
    <div class="logo-wrap">
      <img src="logo.png" alt="Bonanza Transportation" class="logo"/>
    </div>
  </header>

  <main>
    <!-- Full Name -->
    <label for="fullname">Full Name</label>
    <input type="text" id="fullname" name="fullname" placeholder="Enter your full name" required>

    <!-- Phone -->
    <label for="phone">Phone</label>
    <input type="tel" id="phone" name="phone" placeholder="(123) 456-7890" required>
    <div id="phoneHelp" class="hint"></div>

    <!-- Email -->
    <label for="email">Email</label>
    <input type="email" id="email" name="email" placeholder="you@example.com" required>
    <div id="emailHelp" class="hint"></div>

    <!-- Pickup -->
    <label for="pickup">Pickup Location</label>
    <input type="text" id="pickup" name="pickup" placeholder="Enter pickup address" required>

    <!-- Dropoff -->
    <label for="dropoff">Drop-off Location</label>
    <input type="text" id="dropoff" name="dropoff" placeholder="Enter drop-off address" required>

    <!-- Date & Time -->
    <div class="input-row">
      <div>
        <label for="date">Pickup Date</label>
        <input type="date" id="date" name="date" required>
      </div>
      <div>
        <label for="time">Pickup Time</label>
        <input type="time" id="time" name="time" required>
      </div>
    </div>

    <!-- Flight Info (Commercial) -->
    <div id="flightContainer" style="display:none;">
      <label for="flightNumber">Flight Number</label>
      <input type="text" id="flightNumber" name="flightNumber" placeholder="e.g. DL1234">
      <label for="flightOrigin">Flight Origin City</label>
      <input type="text" id="flightOrigin" name="flightOrigin" placeholder="e.g. Atlanta">
    </div>

    <!-- Flight Info (Private) -->
    <div id="privateFlightContainer" style="display:none;">
      <label for="tailNumber">Tail Number</label>
      <input type="text" id="tailNumber" name="tailNumber" placeholder="e.g. N12345">
      <label for="pvtOrigin">Private Flight Origin City</label>
      <input type="text" id="pvtOrigin" name="pvtOrigin" placeholder="e.g. Los Angeles">
    </div>

    <!-- Vehicle Selector -->
    <div class="veh-toggle">
      <button type="button" class="veh-btn active" id="vehSUV">SUV 1–5 Passengers</button>
      <button type="button" class="veh-btn" id="vehVAN">Van 12 Passengers</button>
    </div>
    <div class="turntable">
      <img src="suv.png" alt="SUV" id="vehicleImage" class="car">
      <div class="platform"></div>
      <div id="vehicleCaption" class="vehicle-caption">SUV 1–5 Passengers</div>
    </div>

    <!-- Luggage Accordion -->
    <div id="luggageAccordion" class="luggage-accordion">
      <div id="luggageSummary" class="luggage-summary">
        <div class="luggage-title">Luggage Guidelines</div>
        <div class="luggage-chev"></div>
      </div>
      <div class="luggage-body">
        <div class="lug-section">
          <h4>SUV</h4>
          <p class="lug-note">Max 5 suitcases + small carry-ons</p>
        </div>
        <div class="lug-section">
          <h4>Van</h4>
          <p class="lug-note">Max 12 suitcases + small carry-ons</p>
        </div>
      </div>
    </div>

    <!-- Terms & Conditions -->
    <div class="terms-box" id="termsBox">
      <div class="terms-summary" id="openTermsModal">
        <div>View Full Terms & Conditions</div>
        <div class="chev"></div>
      </div>
      <div class="terms-body">
        <div class="terms-content clamped">
          Please review our full terms and conditions before proceeding. You must accept them to continue with your booking.
        </div>
        <button type="button" class="readmore-btn" id="readMoreTerms">Read More</button>
      </div>
      <div style="display:flex;align-items:center;margin-top:8px;">
        <div class="accept-pill" id="acceptTermsPill">
          <div class="accept-dot"></div>
        </div>
        <span class="accept-label">I accept the Terms & Conditions</span>
      </div>
    </div>
    <!-- index.html — Parte 3/9 -->
    <!-- Map -->
    <div id="map"></div>

    <!-- Buttons -->
    <button type="button" id="calculateBtn" disabled>Calculate Price</button>
    <button type="button" id="payBtn" disabled>PAY NOW</button>

    <!-- Trip Summary -->
    <div id="info">
      <div class="info-title">Trip Summary</div>
      <div class="kpis">
        <div class="kpi">
          <div class="label">Distance</div>
          <div><span class="value" id="distance">0</span><span class="unit">mi</span></div>
        </div>
        <div class="kpi">
          <div class="label">Duration</div>
          <div><span class="value" id="duration">0</span><span class="unit">min</span></div>
        </div>
        <div class="kpi">
          <div class="label">Price</div>
          <div><span class="value price" id="price">$0</span></div>
        </div>
      </div>
      <div class="divider"></div>
      <div class="breakdown">
        <div class="row"><span>Base Fare</span><span id="baseFare">$0</span></div>
        <div class="row"><span>Extra Fees</span><span id="extraFees">$0</span></div>
        <div class="row total"><span>Total</span><span id="totalPrice">$0</span></div>
      </div>
    </div>
  </main>

  <!-- Modal Terms -->
  <div class="modal-backdrop" id="termsModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Terms & Conditions</div>
        <button type="button" class="close-btn" id="closeTermsModal">Close</button>
      </div>
      <div class="modal-body">
        <p>Welcome to Bonanza Transportation. By booking our services, you agree to the following terms:</p>
        <ul>
          <li>All bookings must be confirmed with valid contact information.</li>
          <li>Cancellations within 24 hours of pickup will incur a full fare charge.</li>
          <li>Delays caused by weather or traffic are beyond our control.</li>
          <li>For private flights, tail number and origin city must be provided.</li>
        </ul>
        <p>We strive to provide a safe and timely service. Thank you for choosing Bonanza Transportation.</p>
      </div>
    </div>
  </div>

  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDN6B8izVVhi9CGiO-_TXdhquQAE_i5Lts&libraries=places"
    async defer></script>

  <script>
    let map, pickupAutocomplete, dropoffAutocomplete, directionsService, directionsRenderer;
    let selectedVehicle = 'SUV';
    let priceData = { base: 0, extra: 0, total: 0 };
    <!-- index.html — Parte 4/9 -->
    function initMap() {
      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({ suppressMarkers: false });

      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 40.6461, lng: -111.49797 },
        zoom: 10,
        mapTypeControl: false,
        streetViewControl: false,
        fullscreenControl: false,
      });

      directionsRenderer.setMap(map);

      const pickupInput = document.getElementById("pickup");
      const dropoffInput = document.getElementById("dropoff");

      pickupAutocomplete = new google.maps.places.Autocomplete(pickupInput);
      dropoffAutocomplete = new google.maps.places.Autocomplete(dropoffInput);

      pickupAutocomplete.addListener("place_changed", () => {
        pickupInput.dataset.placeSelected = "true";
      });
      dropoffAutocomplete.addListener("place_changed", () => {
        dropoffInput.dataset.placeSelected = "true";
      });
    }

    window.initMap = initMap;

    function updateFlightVisibility() {
      const pickupValue = document.getElementById("pickup").value.toLowerCase();
      const flightContainer = document.getElementById("flightContainer");
      const privateFlightContainer = document.getElementById("privateFlightContainer");

      const showCommercial = pickupValue.includes("salt lake city international");
      const showPrivate = pickupValue.includes("private") || pickupValue.includes("hangar");

      flightContainer.style.display = showCommercial ? "block" : "none";
      privateFlightContainer.style.display = showPrivate ? "block" : "none";

      const flightNumber = document.getElementById("flightNumber");
      const flightOrigin = document.getElementById("flightOrigin");
      const tailNumber = document.getElementById("tailNumber");
      const pvtOrigin = document.getElementById("pvtOrigin");

      flightNumber.required = showCommercial;
      flightOrigin.required = showCommercial;
      tailNumber.required = showPrivate;
      pvtOrigin.required = showPrivate;

      if (!showCommercial) {
        flightNumber.value = "";
        flightOrigin.value = "";
        flightNumber.setCustomValidity("");
        flightOrigin.setCustomValidity("");
      }

      if (!showPrivate) {
        tailNumber.value = "";
        pvtOrigin.value = "";
        tailNumber.setCustomValidity("");
        pvtOrigin.setCustomValidity("");
      }
    }

    document.getElementById("pickup").addEventListener("input", updateFlightVisibility);
    <!-- index.html — Parte 5/9 -->
    function wireEmail() {
      const input = document.getElementById("email");
      const help = document.getElementById("emailHelp");
      if (!input) return;

      function validateEmail(v) {
        const val = (v || "").trim();
        const basic = /^[^\s@]+@[^\s@]+\.[^\s@]{2,24}$/.test(val);
        if (!basic) return { ok: false, msg: "Please enter a valid email, e.g., name@domain.com" };
        if (/\.\./.test(val)) return { ok: false, msg: "Email cannot contain consecutive dots" };
        const typos = [/@gmal\.com$/i, /@gmial\.com$/i, /@hotnail\.com$/i, /@yaho\.com$/i];
        if (typos.some(rx => rx.test(val))) return { ok: false, msg: "Please correct the domain spelling (e.g., @gmail.com)" };
        return { ok: true, msg: "Email looks good" };
      }

      input.addEventListener("input", () => {
        const r = validateEmail(input.value);
        input.setCustomValidity(r.ok ? "" : r.msg);
        if (help) {
          help.textContent = r.ok ? "Valid email" : r.msg;
          help.className = "hint " + (r.ok ? "ok" : "err");
        }
      });

      input.addEventListener("blur", () => {
        if (!input.checkValidity() && help) {
          help.className = "hint err";
        }
      });
    }

    function wirePhone() {
      const input = document.getElementById("phone");
      const help = document.getElementById("phoneHelp");
      if (!input) return;

      function formatUS(digits) {
        if (digits.startsWith("1")) digits = digits.slice(1);
        digits = digits.slice(0, 10);
        const a = digits.slice(0, 3), b = digits.slice(3, 6), c = digits.slice(6, 10);
        if (digits.length > 6) return `(${a}) ${b}-${c}`;
        if (digits.length > 3) return `(${a}) ${b}`;
        if (digits.length > 0) return `(${a}`;
        return "";
      }

      function validateNANP(digits) {
        if (digits.length === 11 && digits.startsWith("1")) digits = digits.slice(1);
        if (digits.length !== 10) return { ok: false, msg: "Enter a 10-digit US number" };
        if (!/^[2-9]/.test(digits[0])) return { ok: false, msg: "Area code must start 2–9" };
        if (!/^[2-9]/.test(digits[3])) return { ok: false, msg: "Exchange must start 2–9" };
        return { ok: true, msg: "Valid US number" };
      }

      input.addEventListener("input", () => {
        const digits = input.value.replace(/\D/g, "").slice(0, 11);
        input.value = formatUS(digits);
        const v = validateNANP(digits);
        input.setCustomValidity(v.ok ? "" : v.msg);
        if (help) {
          help.textContent = v.ok ? "Valid US number" : v.msg;
          help.className = "hint " + (v.ok ? "ok" : "err");
        }
      });

      input.addEventListener("blur", () => {
        if (!input.checkValidity() && help) {
          help.className = "hint err";
        }
      });
    }

    function requireAllOrAlert() {
      const fieldsAlways = ["fullname", "phone", "email", "pickup", "dropoff", "date", "time"];
      const requiredFields = [...fieldsAlways];
      const flightVisible = document.getElementById("flightContainer").style.display !== "none";
      const pvtVisible = document.getElementById("privateFlightContainer").style.display !== "none";

      if (flightVisible) {
        requiredFields.push("flightNumber", "flightOrigin");
      }
      if (pvtVisible) {
        requiredFields.push("tailNumber", "pvtOrigin");
      }

      for (let id of requiredFields) {
        const el = document.getElementById(id);
        if (el && !el.checkValidity()) {
          el.reportValidity();
          alert("Please complete all required fields before continuing.");
          return false;
        }
      }

      const termsAccepted = document.getElementById("acceptTermsPill").classList.contains("active");
      if (!termsAccepted) {
        alert("You must accept the Terms & Conditions to proceed.");
        return false;
      }
      return true;
    }<!-- index.html — Parte 6/9 -->
    /* ===== Vehicle selector ===== */
    (function wireVehicleSelector(){
      const suvBtn = document.getElementById('vehSUV');
      const vanBtn = document.getElementById('vehVAN');
      const img    = document.getElementById('vehicleImage');
      const cap    = document.getElementById('vehicleCaption');

      function set(type){
        selectedVehicle = (type === 'VAN') ? 'VAN' : 'SUV';
        suvBtn.classList.toggle('active', selectedVehicle==='SUV');
        vanBtn.classList.toggle('active', selectedVehicle==='VAN');
        img.src = selectedVehicle==='VAN' ? 'van.png' : 'suv.png';
        cap.textContent = selectedVehicle==='VAN' ? 'Van 12 Passengers' : 'SUV 1–5 Passengers';
      }

      suvBtn?.addEventListener('click', ()=> set('SUV'));
      vanBtn?.addEventListener('click', ()=> set('VAN'));
      set('SUV');
    })();

    /* ===== Terms accept pill + buttons state ===== */
    const acceptPill = document.getElementById('acceptTermsPill');
    const calculateBtn = document.getElementById('calculateBtn');
    const payBtn = document.getElementById('payBtn');

    function syncButtons(){
      const accepted = acceptPill?.classList.contains('active');
      if (calculateBtn) calculateBtn.disabled = !accepted;
      if (payBtn)       payBtn.disabled = !accepted || priceData.total <= 0;
    }

    acceptPill?.addEventListener('click', ()=>{
      acceptPill.classList.toggle('active');
      syncButtons();
    });

    /* ===== Luggage Accordion (wiring) ===== */
    (function wireLuggageAccordion(){
      const acc = document.getElementById('luggageAccordion');
      const sum = document.getElementById('luggageSummary');
      if(!acc || !sum) return;
      sum.addEventListener('click', ()=>{
        const open = acc.classList.toggle('open');
        acc.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    })();

    /* ===== Terms Modal (open/close) ===== */
    (function wireTermsModal(){
      const modal   = document.getElementById('termsModal');
      const openBtn = document.getElementById('openTermsModal');
      const closeBtn= document.getElementById('closeTermsModal');

      function openModal(){
        if(!modal) return;
        modal.classList.add('open');
        modal.setAttribute('aria-hidden','false');
        document.body.style.overflow = 'hidden';
        closeBtn?.focus();
      }
      function closeModal(){
        if(!modal) return;
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden','true');
        document.body.style.overflow = '';
        openBtn?.focus();
      }

      openBtn?.addEventListener('click', openModal);
      closeBtn?.addEventListener('click', closeModal);
      modal?.addEventListener('click', (e)=> { if(e.target === modal) closeModal(); });
      document.addEventListener('keydown', (e)=> { if(e.key === 'Escape' && modal?.classList.contains('open')) closeModal(); });
    })();

    /* ===== Pricing (official table) ===== */
    function calculateBase(mi){
      if (mi <= 10) return 120;
      if (mi <= 35) return 190;
      if (mi <= 39) return 210;
      if (mi <= 48) return 230;
      if (mi <= 55) return 250;
      return mi * 5.4;
    }
    function applyVehicleMultiplier(total){
      return selectedVehicle === 'VAN' ? Math.round(total * 1.30) : Math.round(total);
    }
    function isAfterHours(dateStr, timeStr){
      if(!dateStr || !timeStr) return false;
      const d = new Date(`${dateStr}T${timeStr}:00`);
      const start = new Date(d); start.setHours(6, 0, 0, 0);
      const end   = new Date(d); end.setHours(23,0, 0, 0);
      return (d < start) || (d > end);
    }

    /* ===== Safe init for Maps even without callback param ===== */
    (function ensureInitMap(){
      if (window.google?.maps) { try{ initMap(); }catch(_){/* noop */} return; }
      const iv = setInterval(()=>{
        if (window.google?.maps){
          clearInterval(iv);
          try{ initMap(); }catch(_){/* noop */ }
        }
      }, 200);
      setTimeout(()=> clearInterval(iv), 10000); // dejar de esperar a los 10s
    })();
    <!-- index.html — Parte 7/9 -->
    /* ===== Routing + Pricing ===== */
    function milesFromMeters(m){ return m / 1609.344; }

    function renderSummary(leg, afterHours){
      const miles = milesFromMeters(leg.distance.value);
      const mins  = Math.round(leg.duration.value / 60);

      const base  = calculateBase(miles);
      const ahFee = afterHours ? Math.round((base) * 0.20) : 0;
      const total = applyVehicleMultiplier(base + ahFee);

      // persist for PAY
      priceData = { base, extra: ahFee, total };

      // UI
      document.getElementById('info').style.display = 'block';
      document.getElementById('distance').textContent   = miles.toFixed(1);
      document.getElementById('duration').textContent   = mins.toString();
      document.getElementById('price').textContent      = `$${total.toFixed(2)}`;
      document.getElementById('baseFare').textContent   = `$${base.toFixed(2)}`;
      document.getElementById('extraFees').textContent  = `$${ahFee.toFixed(2)}`;
      document.getElementById('totalPrice').textContent = `$${total.toFixed(2)}`;

      syncButtons();
    }

    async function computeRouteAndPrice(){
      const pickup  = document.getElementById('pickup').value.trim();
      const dropoff = document.getElementById('dropoff').value.trim();
      const dateStr = document.getElementById('date').value;
      const timeStr = document.getElementById('time').value;

      if(!pickup || !dropoff){
        alert('Please enter pickup and drop-off addresses.');
        return;
      }

      const req = {
        origin: pickup,
        destination: dropoff,
        travelMode: google.maps.TravelMode.DRIVING
      };

      directionsService.route(req,(res,status)=>{
        if(status !== 'OK' || !res?.routes?.[0]?.legs?.[0]){
          alert('Unable to calculate route. Please check the addresses.');
          return;
        }
        directionsRenderer.setDirections(res);
        const leg = res.routes[0].legs[0];
        const after = isAfterHours(dateStr, timeStr);
        renderSummary(leg, after);
      });
    }<!-- index.html — Parte 8/9 -->
    /* ===== Botón Calculate Price ===== */
    calculateBtn?.addEventListener('click', ()=>{
      if (!requireAllOrAlert()) return; // Bloquea si falta algo
      computeRouteAndPrice();
    });

    /* ===== Botón PAY NOW ===== */
    payBtn?.addEventListener('click', async ()=>{
      if (!requireAllOrAlert()) return; // Bloquea si falta algo
      if (priceData.total <= 0){
        alert('Please calculate the price before paying.');
        return;
      }
      try {
        const res = await fetch('/api/create-checkout-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ amount: priceData.total })
        });
        const data = await res.json();
        if (data?.url) {
          window.location.href = data.url;
        } else {
          alert('Unable to initiate payment.');
        }
      } catch (err) {
        console.error(err);
        alert('Error initiating payment.');
      }
    });

    /* ===== Inicializar validaciones al cargar ===== */
    document.addEventListener('DOMContentLoaded', ()=>{
      wireEmail();
      wirePhone();
      syncButtons();
    });
  </script>
</body>
</html>
