<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bonanza Transportation</title>

  <style>
    :root{ --copper:#a8744f; --ok:#17c964; --warn:#ffcc66; --err:#ff6b6b; }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:#000;color:var(--copper);font-family:Arial,sans-serif}

    /* Header / Logo */
    header{display:flex;justify-content:center;align-items:center;padding:20px 16px}
    .logo-wrap{ position:relative }
    .logo{
      width:180px;height:180px;border-radius:50%;border:2px solid var(--copper);
      object-fit:cover;display:block;position:relative;
      box-shadow:0 0 2px rgba(192,139,92,.35) inset,0 0 8px rgba(0,0,0,.6),0 0 10px rgba(192,139,92,.45);
      filter: drop-shadow(0 0 5px rgba(192,139,92,.45));
    }
        .logo-wrap::after{
      content:"";
      position:absolute;
      inset:-8px;
      border-radius:50%;
      box-shadow:0 0 22px 10px rgba(192,139,92,.35);
      pointer-events:none;
    }

    /* Layout */
    main{
      max-width:760px;
      width:92vw;
      margin:0 auto 40px;
      padding:0 16px
    }
    label{
      display:block;
      margin:12px 0 6px;
      font-weight:700
    }

    /* Inputs: oscuros en todos (incl. autofill) */
    input,select{
      display:block;
      width:100%;
      height:44px;
      padding:10px 12px;
      background:#1a1a1a;
      color:var(--copper);
      border:1px solid #444;
      border-radius:8px;
      outline:none;
    }
        input:focus,select:focus{
      border-color:var(--copper);
      box-shadow:0 0 0 3px rgba(168,116,79,.18)
    }
    ::placeholder{
      color:#cba686;
      opacity:.65
    }

    /* Fuerza oscuro también cuando el navegador autocompleta */
    input:-webkit-autofill,
    input:-webkit-autofill:focus{
      -webkit-text-fill-color: var(--copper);
      transition: background-color 50000s ease-in-out 0s;
      box-shadow: 0 0 0 1000px #1a1a1a inset;
      border:1px solid #444;
    }

    button{
      width:100%;
      padding:14px 16px;
      margin-top:18px;
      background:var(--copper);
      color:#000;
      font-weight:700;
      font-size:18px;
      border:0;
      border-radius:10px;
      cursor:pointer;
    }
    button:disabled{
      opacity:0.5;
      cursor:not-allowed;
    }    #map{
      height:380px;
      margin-top:10px;
      border-radius:12px;
      overflow:hidden
    }

    /* Trip Summary */
    #info{
      display:none;
      margin-top:18px;
      border-radius:16px;
      padding:18px;
      background:linear-gradient(180deg,#121212,#0b0b0b);
      border:1px solid rgba(192,139,92,.28);
      box-shadow:0 18px 40px rgba(0,0,0,.55);
      color:#e9d5c1;
      font-size:.95em;
    }
    .info-title{
      font-weight:800;
      margin:0 0 4px;
      font-size:1.05rem
    }
    .kpis{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:12px;
      margin:10px 0 12px;
    }
    .kpi{
      background:#0e0e0e;
      border:1px solid rgba(192,139,92,.18);
      border-radius:12px;
      padding:12px;
    }
        .kpi .label{
      font-size:.75rem;
      opacity:.8;
      margin-bottom:6px
    }
    .kpi .value{
      font-size:1.35rem;
      font-weight:800;
      color:#f0d1ad
    }
    .kpi .unit{
      font-size:.9rem;
      opacity:.7;
      margin-left:4px
    }
    .kpi .value.price{
      color:#ffddae
    }
    .breakdown{
      margin:6px 0 12px;
    }
    .breakdown .row{
      display:flex;
      justify-content:space-between;
      padding:6px 0;
    }
    .breakdown .row.total{
      font-weight:800;
      color:#ffddae;
      font-size:1.05rem
    }
    .divider{
      height:1px;
      background:linear-gradient(90deg,transparent,rgba(192,139,92,.35),transparent);
      margin:6px 0
    }
        /* Date/Time */
    .input-row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media (max-width:520px){
      .input-row{grid-template-columns:1fr;}
    }
    #date,#time{
      height:56px;
      font-size:17px;
      border-radius:12px;
      background:#1f1f1f;
      color:#fff;
      border:2px solid var(--copper);
      box-shadow:0 0 0 3px rgba(168,116,79,.18);
    }
    #date:focus,#time:focus{
      outline:none;
      border-color:#ffd9a1;
      box-shadow:0 0 0 4px rgba(255,217,161,.22);
    }
    input[type="date"]::-webkit-calendar-picker-indicator,
    input[type="time"]::-webkit-calendar-picker-indicator{
      filter:invert(80%) sepia(20%) saturate(180%) hue-rotate(340deg) brightness(110%);
      opacity:.95;
      cursor:pointer;
    }
    .helper{
      font-size:.85rem;
      opacity:.95;
      margin-top:6px;
      color:#ffddae;
    }
        /* Vehicle visual */
    .turntable{
      margin:10px 0 6px;
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    .turntable .car{
      width:260px;
      height:auto;
      filter:drop-shadow(0 12px 18px rgba(0,0,0,.6));
    }
    .turntable .platform{
      width:220px;
      height:22px;
      border-radius:50%;
      background:radial-gradient(ellipse at center, rgba(0,0,0,.7) 0%, rgba(0,0,0,.25) 60%, rgba(0,0,0,0) 70%);
      margin-top:6px;
    }
    .vehicle-caption{
      font-weight:700;
      color:#ffddae;
      margin-top:6px;
      letter-spacing:.2px;
    }

    /* Vehicle selector */
    .veh-toggle{
      display:flex;
      gap:8px;
      margin:10px 0;
    }
    .veh-btn{
      flex:1 1 0;
      background:#1a1a1a;
      border:1px solid rgba(168,116,79,.55);
      color:var(--copper);
      padding:12px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
    }
    .veh-btn.active{
      background:var(--copper);
      color:#000;
      border-color:var(--copper);
      box-shadow:0 0 0 3px rgba(168,116,79,.25);
    }
        /* Terms checkbox */
    .terms{
      margin-top:16px;
      font-size:.85rem;
      display:flex;
      align-items:flex-start;
      gap:8px;
    }
    .terms input[type="checkbox"]{
      margin-top:2px;
    }
    .terms a{
      color:#ffddae;
    }

    /* Footer */
    footer{
      text-align:center;
      font-size:.8rem;
      color:#aa8b72;
      padding:18px 0 26px;
    }
  </style>
</head>

<body>
  <header>
    <div class="logo-wrap">
      <img src="logo.jpg" alt="Bonanza Transportation" class="logo"/>
    </div>
  </header>

  <main>
    <label for="pickup">Pickup Location</label>
    <input id="pickup" placeholder="Enter pickup location"/>

    <label for="dropoff">Dropoff Location</label>
    <input id="dropoff" placeholder="Enter dropoff location"/>

    <div id="map"></div>
        <label for="date">Date</label>
    <input id="date" type="date"/>

    <label for="time">Time</label>
    <input id="time" type="time" step="900"/>

    <div class="veh-toggle">
      <button class="veh-btn active" data-type="suv">SUV (1-5 Passengers)</button>
      <button class="veh-btn" data-type="van">Van (up to 12 Passengers)</button>
    </div>

    <div class="turntable">
      <img class="car" src="suv.png" alt="Selected Vehicle"/>
      <div class="platform"></div>
      <div class="vehicle-caption">SUV — Max 5 passengers, 5 suitcases</div>
    </div>

    <button id="calculate" disabled>Calculate Price</button>
    <button id="pay" disabled style="display:none">PAY NOW</button>

    <div id="info"></div>
        <div class="terms-box" id="terms-box">
      <div class="terms-summary">
        <div class="accept-pill" id="acceptPill" tabindex="0" role="switch" aria-checked="false">
          <div class="accept-dot"></div>
        </div>
        <div class="accept-label">I accept the Terms & Conditions</div>
      </div>
      <div class="terms-body">
        <div id="terms-content" class="terms-content clamped">
          By booking with Bonanza Transportation, you agree to our policies including but not limited to payment terms,
          cancellation policy, and liability limits. Please read carefully before proceeding. Bonanza Transportation
          reserves the right to modify or cancel reservations if conditions warrant. Full terms are available upon request.
        </div>
        <button type="button" id="openTermsModal" class="readmore-btn">View Full Terms</button>
      </div>
    </div>

    <div id="map"></div>
        <!-- PAY NOW movido debajo del mapa -->
    <button id="pay" disabled style="display:none">PAY NOW</button>

    <!-- Resumen -->
    <div id="info"></div>

    <!-- Modal Términos -->
    <div class="modal-backdrop" id="termsModal" aria-hidden="true">
      <div class="modal" role="dialog" aria-labelledby="termsTitle" aria-modal="true">
        <div class="modal-header">
          <h2 id="termsTitle" class="modal-title">Terms & Conditions</h2>
          <button id="closeTerms" class="close-btn">Close</button>
        </div>
        <div class="modal-body" style="line-height:1.6">
          <h3 style="margin:0 0 8px;color:#ffddae">Terms and Conditions</h3>
          <div style="opacity:.85;margin-bottom:8px">Bonanza Transportation — Last updated: 2024</div>
          <div class="divider" style="height:1px;background:linear-gradient(90deg,transparent,rgba(192,139,92,.35),transparent);margin:8px 0 14px"></div>
                    <h4 style="color:#ffddae;margin:10px 0 6px">1. Introduction and Acceptance</h4>
          <p>Welcome to Bonanza Transportation. By booking, hiring, or using our services, you agree to comply with these Terms and Conditions. We reserve the right to modify them at any time; updated versions will be available on our website and will take effect immediately.</p>

          <h4 style="color:#ffddae;margin:10px 0 6px">2. Definitions</h4>
          <ul>
            <li><strong>Client:</strong> The individual or entity booking services from Bonanza Transportation.</li>
            <li><strong>Service:</strong> Private transportation provided by Bonanza Transportation, including airport pickups, events, transfers, and private trips.</li>
            <li><strong>Booking:</strong> A confirmed service agreement with Bonanza Transportation.</li>
            <li><strong>Cancellation:</strong> Termination of a confirmed booking.</li>
            <li><strong>Fare:</strong> The agreed price for the contracted service.</li>
          </ul>

          <h4 style="color:#ffddae;margin:10px 0 6px">3. Bookings and Payments</h4>
          <ul>
            <li>Bookings must be made in advance via our website, mobile app, text message, phone, or email.</li>
            <li>Payments may be made by credit/debit card or secure platforms such as Stripe.</li>
            <li>Bonanza Transportation may require partial or full payment at the time of booking confirmation.</li>
            <li>All fares are quoted in U.S. Dollars (USD) and include applicable taxes unless otherwise stated.</li>
            <li>All information provided by the client is their sole responsibility. Bonanza Transportation will honor details exactly as written; we are not responsible for errors or omissions caused by typos or incorrect information.</li>
          </ul>
                    <h4 style="color:#ffddae;margin:10px 0 6px">4. Cancellations and Refunds</h4>
          <ul>
            <li>Cancellations made more than 24 hours before the scheduled pickup time are eligible for a full refund.</li>
            <li>Cancellations made within 24 hours of the scheduled pickup time are non-refundable.</li>
            <li>No-shows will be charged the full fare.</li>
          </ul>

          <h4 style="color:#ffddae;margin:10px 0 6px">5. Service Conditions</h4>
          <ul>
            <li>Bonanza Transportation reserves the right to refuse service to any person who is under the influence of drugs or alcohol, is behaving inappropriately, or poses a safety risk.</li>
            <li>Eating, drinking (except water), and smoking are prohibited in all vehicles.</li>
            <li>Clients are responsible for any damage caused to the vehicle during their trip.</li>
          </ul>

          <h4 style="color:#ffddae;margin:10px 0 6px">6. Liability</h4>
          <p>Bonanza Transportation will not be held liable for delays caused by circumstances beyond our control, including but not limited to traffic, weather conditions, or mechanical failures.</p>

          <h4 style="color:#ffddae;margin:10px 0 6px">7. Governing Law</h4>
          <p>These Terms and Conditions shall be governed by and construed in accordance with the laws of the State of Utah, USA.</p>
        </div>
      </div>
    </div>
      </main>

  <footer>
    &copy; 2024 Bonanza Transportation. All rights reserved.
  </footer>

  <!-- API base para backend -->
  <script>
    // Si el API vive en el mismo dominio detrás de Nginx, deja vacío ('')
    // Si usas subdominio (p.ej. https://api.tudominio.com), ponlo aquí.
    const API_BASE = '';
  </script>

  <script>
    let map, pickupAutocomplete, dropoffAutocomplete, pickupPlace, dropoffPlace;
    let selectedVehicle = 'suv';
    let payBtn, calcBtn;

    function initMap(){
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 40.7608, lng: -111.8910 },
        zoom: 10,
        mapTypeControl: false
      });

      pickupAutocomplete = new google.maps.places.Autocomplete(
        document.getElementById("pickup"), { fields: ["place_id", "formatted_address", "geometry"] }
      );
      dropoffAutocomplete = new google.maps.places.Autocomplete(
        document.getElementById("dropoff"), { fields: ["place_id", "formatted_address", "geometry"] }
      );

      pickupAutocomplete.addListener("place_changed", ()=>{
        pickupPlace = pickupAutocomplete.getPlace();
        calcBtn.disabled = !(pickupPlace && dropoffPlace);
      });
            dropoffAutocomplete.addListener("place_changed", ()=>{
        dropoffPlace = dropoffAutocomplete.getPlace();
        calcBtn.disabled = !(pickupPlace && dropoffPlace);
      });
    }

    document.addEventListener("DOMContentLoaded", ()=>{
      calcBtn = document.getElementById("calculate");
      payBtn  = document.getElementById("pay");

      // Selector de vehículo
      document.querySelectorAll('.veh-btn').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          document.querySelectorAll('.veh-btn').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          selectedVehicle = btn.dataset.type;
        });
      });

      // Calcular precio
      calcBtn.addEventListener("click", async ()=>{
        if(!(pickupPlace && dropoffPlace)){ alert("Select both pickup and dropoff."); return; }

        // Lógica local (mapas) omitida para brevedad...
        // === SERVER QUOTE ===
        try {
          const qRes = await fetch(`${API_BASE}/api/quote`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              pickupPlaceId: pickupPlace.place_id,
              dropoffPlaceId: dropoffPlace.place_id,
              pickupAddress: pickupPlace.formatted_address || document.getElementById('pickup').value,
              dropoffAddress: dropoffPlace.formatted_address || document.getElementById('dropoff').value,
                            localDateISO: document.getElementById('date').value,
              localTime: document.getElementById('time').value,
              vehicle: selectedVehicle
            })
          });

          if (!qRes.ok) throw new Error('Quote failed');
          const quote = await qRes.json();

          window.__bookingDraftId = quote.bookingDraftId;
          if (quote.priceCents) {
            document.getElementById('info').style.display = 'block';
            document.getElementById('info').innerHTML =
              `<div class="info-title">Trip Summary</div>
               <div class="kpis">
                 <div class="kpi"><div class="label">Miles</div><div class="value">${quote.miles}</div></div>
                 <div class="kpi"><div class="label">Price</div><div class="value price">$${(quote.priceCents/100).toFixed(2)}</div></div>
               </div>`;
          }

          payBtn.style.display = 'block';
          payBtn.disabled = false;
        } catch (e) {
          console.error(e);
          alert('We could not finalize your quote. Please try again.');
        }
      });

      // Pagar
      payBtn.addEventListener('click', async ()=>{
        if(!window.__bookingDraftId){
          alert('Please calculate price first.');
          return;
        }
                try {
          const resp = await fetch(`${API_BASE}/api/checkout`, {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify({ bookingDraftId: window.__bookingDraftId })
          });
          if(!resp.ok) throw new Error('Checkout failed');
          const { url } = await resp.json();
          if(!url) throw new Error('Missing redirect URL');
          window.location = url; // Stripe Checkout
        } catch (err){
          console.error(err);
          alert('Could not start payment. Please try again.');
        }
      });
    });
  </script>
    <script>
    // Terms pill (activa botones)
    const acceptPill  = document.getElementById('acceptPill');
    const calcBtnRef  = document.getElementById('calculate');
    const payBtnRef   = document.getElementById('pay');

    function isAccepted(){ return acceptPill?.classList.contains('on'); }
    function syncButtons(){
      const accepted = isAccepted();
      if(calcBtnRef) calcBtnRef.disabled = !accepted;
      if(payBtnRef){
        payBtnRef.disabled = !accepted || !window.__bookingDraftId;
        payBtnRef.style.display = 'block';
      }
    }
    function setAcceptedState(on){
      acceptPill.classList.toggle('on', on);
      acceptPill.setAttribute('aria-checked', on ? 'true' : 'false');
      syncButtons();
    }
    acceptPill?.addEventListener('click', ()=> setAcceptedState(!isAccepted()));
    acceptPill?.addEventListener('keydown', (e)=>{ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); setAcceptedState(!isAccepted()); }});
    document.addEventListener('DOMContentLoaded', syncButtons);
  </script>
    <!-- Modal Terms (open/close simple) -->
  <script>
    (function(){
      const modal   = document.getElementById('termsModal');
      const openBtn = document.getElementById('openTermsModal');
      const closeBtn= document.getElementById('closeTerms');
      function openModal(){
        modal.classList.add('open');
        modal.setAttribute('aria-hidden','false');
        document.body.style.overflow = 'hidden';
        closeBtn?.focus();
      }
      function closeModal(){
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden','true');
        document.body.style.overflow = '';
        openBtn?.focus();
      }
      openBtn?.addEventListener('click', openModal);
      closeBtn?.addEventListener('click', closeModal);
      modal?.addEventListener('click', (e)=> { if(e.target === modal) closeModal(); });
      document.addEventListener('keydown', (e)=> { if(e.key === 'Escape' && modal?.classList.contains('open')) closeModal(); });
    })();
  </script>
    <!-- Google Maps (labels en ingles) -->
  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDN6B8izVVhi9CGiO-_TXdhquQAE_i5Lts&libraries=places&language=en&region=US&callback=initMap">
  </script>
</body>
</html>
