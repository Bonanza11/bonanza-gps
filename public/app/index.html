<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Bonanza Transportation — Booking</title>

  <!-- Brand -->
  <link rel="icon" href="/images/bonanza-logo.png" />
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#b66a2c" />

  <!-- (Opcional) Si prefieres CSS externo, luego te paso /styles/app.css -->
  <style>
    :root{ --copper:#a8744f; --ok:#17c964; --warn:#ffcc66; --err:#ff6b6b; --txt:#e9d5c1; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:#000;color:var(--copper);font-family:Arial,sans-serif}
    header{display:flex;justify-content:center;align-items:center;padding:20px 16px}
    .logo-wrap{ position:relative }
    .logo{
      width:180px;height:180px;border-radius:50%;border:2px solid var(--copper);
      object-fit:cover;display:block;position:relative;
      box-shadow:0 0 2px rgba(192,139,92,.35) inset,0 0 8px rgba(0,0,0,.6),0 0 10px rgba(192,139,92,.45);
      filter: drop-shadow(0 0 5px rgba(192,139,92,.45));
    }
    .logo-wrap::after{content:"";position:absolute;inset:-8px;border-radius:50%;box-shadow:0 0 22px 10px rgba(192,139,92,.35);pointer-events:none;}
    main{max-width:860px;width:92vw;margin:0 auto 40px;padding:0 16px}
    label{display:block;margin:12px 0 6px;font-weight:700}
    input,select,textarea{
      display:block;width:100%;padding:10px 12px;height:44px;
      background:#1a1a1a;color:#fff;border:1px solid #444;border-radius:8px;outline:none;
    }
    textarea{height:60px}
    input:focus,select:focus,textarea:focus{border-color:var(--copper);box-shadow:0 0 0 3px rgba(168,116,79,.18)}
    ::placeholder{color:#cba686;opacity:.65}
    .invalid{border-color: var(--err)!important; box-shadow:0 0 0 3px rgba(255,107,107,.25)!important}
    button{
      width:100%;padding:14px 16px;margin-top:18px;background:var(--copper);color:#000;
      font-weight:700;font-size:18px;border:0;border-radius:10px;cursor:pointer;
    }
    button:disabled{opacity:.5;cursor:not-allowed}
    .input-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media (max-width:520px){.input-row{grid-template-columns:1fr;}}
    #map{height:380px;margin-top:10px;border-radius:12px;overflow:hidden}
    /* Summary */
    #info{
      display:none;margin-top:18px;border-radius:16px;padding:18px;color:var(--txt);
      background:linear-gradient(180deg,#121212,#0b0b0b);
      border:1px solid rgba(192,139,92,.28);box-shadow:0 18px 40px rgba(0,0,0,.55);
      font-size:.95em;
    }
    .info-title{font-weight:800;margin:0 0 4px;font-size:1.05rem}
    .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:10px 0 12px;}
    .kpi{background:#0e0e0e;border:1px solid rgba(192,139,92,.18);border-radius:12px;padding:12px;}
    .kpi .label{font-size:.75rem;opacity:.8;margin-bottom:6px}
    .kpi .value{font-size:1.35rem;font-weight:800;color:#f0d1ad}
    .kpi .unit{font-size:.9rem;opacity:.7;margin-left:4px}
    .kpi .value.price{color:#ffddae}
    .breakdown{margin:6px 0 12px;}
    .breakdown .row{display:flex;justify-content:space-between;padding:6px 0;}
    .breakdown .row.total{font-weight:800;color:#ffddae;font-size:1.05rem}
    .divider{height:1px;background:linear-gradient(90deg,transparent,rgba(192,139,92,.35),transparent);margin:6px 0}
    .tax-note{font-size:13px;color:#c9a97c;font-style:italic;text-align:right;margin-top:4px;opacity:.85}

    /* Vehicle */
    .veh-toggle{display:flex;gap:8px;margin:10px 0}
    .veh-btn{flex:1;background:#1a1a1a;border:1px solid rgba(168,116,79,.55);color:var(--copper);padding:12px;border-radius:10px;cursor:pointer;font-weight:700}
    .veh-btn.active{background:var(--copper);color:#000;border-color:var(--copper);box-shadow:0 0 0 3px rgba(168,116,79,.25)}
    .turntable{margin:10px 0 6px; display:flex; flex-direction:column; align-items:center;}
    .turntable .car{width:260px;height:auto;filter:drop-shadow(0 12px 18px rgba(0,0,0,.6))}
    .turntable .platform{width:220px;height:22px;border-radius:50%;background:radial-gradient(ellipse at center, rgba(0,0,0,.7), rgba(0,0,0,.25) 60%, rgba(0,0,0,0) 70%);margin-top:6px;}
    .vehicle-caption{font-weight:700;color:#ffddae;margin-top:6px;letter-spacing:.2px;}

    /* JSX / Flight / FBO */
    #jsxContainer{display:none;margin-top:10px}
    #flightContainer{display:none}
    #privateFlightContainer{display:none}

    /* Meet & Greet (SLC only) */
    .mg-card{display:none;margin:16px 0;border-radius:14px;border:1px solid rgba(168,116,79,.45);
      background:linear-gradient(180deg,#121212,#0b0b0b);box-shadow:0 12px 24px rgba(0,0,0,.35);padding:16px}
    .mg-card h3{margin:0 0 4px;color:#ffddae;font-size:1.1rem}
    .mg-card p{margin:0 0 12px;font-size:.9rem;opacity:.85}
    .mg-options{display:flex;gap:8px;margin-bottom:8px}
    .mg-btn{flex:1;background:#1a1a1a;border:1px solid rgba(168,116,79,.55);color:var(--copper);padding:10px;border-radius:8px;cursor:pointer;font-weight:700;text-align:center}
    .mg-btn.active{background:var(--copper);color:#000;border-color:var(--copper)}
    .mg-note{font-size:.8rem;color:#aa8b72}

    /* Luggage accordion */
    .luggage-accordion{border:1px solid rgba(168,116,79,.45);border-radius:12px;padding:10px 12px;margin-top:10px;background:#0e0e0e}
    .luggage-summary{display:flex;align-items:center;gap:10px;cursor:pointer}
    .luggage-title{font-weight:700}
    .luggage-chev{width:10px;height:10px;border-right:2px solid var(--copper);border-bottom:2px solid var(--copper);transform:rotate(-45deg);transition:.2s;margin-left:auto}
    .luggage-accordion.open .luggage-chev{transform:rotate(45deg)}
    .luggage-body{display:none;margin-top:10px;color:#e9d5c1;font-size:.95rem;line-height:1.55}
    .luggage-accordion.open .luggage-body{display:block}
    .lug-section h4{margin:6px 0 4px;color:#ffddae}
    .lug-note{opacity:.9;margin:2px 0 8px}
    .lug-list{margin:0 0 10px 18px}

    /* Terms pill */
    .terms-box{border:1px solid rgba(168,116,79,.45);border-radius:12px;padding:10px 12px;margin-top:10px;background:#0e0e0e}
    .terms-summary{display:flex;align-items:center;gap:10px;cursor:pointer}
    .accept-pill{min-width:28px;height:20px;border-radius:999px;border:1px solid #666;display:flex;align-items:center;padding:0 2px;position:relative;background:#1a1a1a}
    .accept-dot{width:14px;height:14px;border-radius:50%;background:#333;transition:.2s;border:1px solid #555}
    .accept-pill.on{border-color:var(--ok);background:rgba(23,201,100,.12)}
    .accept-pill.on .accept-dot{transform:translateX(8px);background:var(--ok);border-color:var(--ok)}
    .accept-label{font-size:.9rem;opacity:.9;margin-left:8px;color:#ffddae}

    /* Modal simple */
    .modal-backdrop{position:fixed;inset:0;display:none;background:rgba(0,0,0,.74);align-items:center;justify-content:center;padding:16px;z-index:9999}
    .modal-backdrop.open{display:flex}
    .modal{max-width:860px;width:100%;max-height:86vh;background:#0e0e0e;border:1px solid rgba(168,116,79,.45);border-radius:12px;box-shadow:0 18px 48px rgba(0,0,0,.7);overflow:hidden;display:flex;flex-direction:column}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid rgba(168,116,79,.28);background:#101010}
    .modal-title{font-weight:800;color:#ffddae}
    .modal-body{padding:14px 16px 18px;overflow:auto;color:#e9d5c1;line-height:1.6}
    .close-btn{background:#1a1a1a;border:1px solid rgba(168,116,79,.45);color:#ffddae;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:700}
  </style>
</head>

<body>
  <header>
    <div class="logo-wrap">
      <img class="logo" src="/images/bonanza-logo.png" alt="Bonanza Transportation Logo">
    </div>
  </header>

  <main>
    <!-- Passenger -->
    <label for="fullname">Full Name:</label>
    <input id="fullname" type="text" placeholder="e.g. John Doe" autocomplete="name" required />

    <label for="phone">Phone Number (US):</label>
    <input id="phone" type="tel" inputmode="numeric" autocomplete="tel" placeholder="(555) 123-4567" required />
    <div id="phoneHelp" class="hint"></div>

    <label for="email">Email Address:</label>
    <input id="email" type="email" placeholder="you@example.com" autocomplete="email" required />
    <div id="emailHelp" class="hint"></div>

    <!-- Route -->
    <label for="pickup">Pick-up Address:</label>
    <input id="pickup" placeholder="e.g. SLC Airport" required />
    <div id="jsxContainer" style="display:none; margin-top:10px;">
      <label for="jsxFlightNumber">JSX Flight Number:</label>
      <input id="jsxFlightNumber" placeholder="e.g. XE1234" />
      <label for="jsxOrigin" style="margin-top:12px;">JSX Origin City:</label>
      <input id="jsxOrigin" placeholder="e.g. Burbank (BUR)" />
    </div>

    <label for="dropoff">Drop-off Address:</label>
    <input id="dropoff" placeholder="e.g. Montage Deer Valley" required />

    <!-- Meet & Greet (SLC) -->
    <div class="mg-card" id="meetGreetCard" aria-label="Meet & Greet options">
      <h3>Meet & Greet — SLC Only</h3>
      <p>Choose where you want your driver to meet you inside the terminal.</p>
      <div class="mg-options" role="group" aria-label="Meet & Greet selection">
        <div class="mg-btn" data-choice="tsa_exit" aria-pressed="false">TSA Exit (+$50)</div>
        <div class="mg-btn" data-choice="baggage_claim" aria-pressed="false">Baggage Claim (+$50)</div>
        <div class="mg-btn active" data-choice="none" aria-pressed="true">No Meet & Greet</div>
      </div>
      <div class="mg-note">
        Available only for SUV arrivals at Salt Lake City International (SLC). Vans must use the designated curbside pickup area.
      </div>
    </div>

    <!-- Special Instructions -->
    <label for="specialInstructions">Special Instructions:</label>
    <textarea id="specialInstructions" placeholder="Gate code, luggage, pickup location…"></textarea>

    <!-- Flight (commercial) -->
    <div id="flightContainer" style="display:none;">
      <label for="flightNumber">Flight Number:</label>
      <input id="flightNumber" placeholder="e.g. DL1234" />
      <div id="flightHint" class="hint warn" style="display:none">
        ✈️ Enter the complete flight number exactly as it appears on your boarding pass or itinerary.
      </div>

      <label for="flightOrigin" style="margin-top:12px;">Flight Origin City:</label>
      <input id="flightOrigin" placeholder="e.g. Miami (MIA)" />
      <div id="originHelp" class="hint" style="display:none"></div>
    </div>
    <div id="backendResult" class="hint" style="display:block; margin-top:6px;"></div>

    <!-- Private Jet (FBO) -->
    <div id="privateFlightContainer" style="display:none;">
      <label for="tailNumber">Jet Tail Number (N-Number):</label>
      <input id="tailNumber" placeholder="e.g., N123AB" />
      <div id="tailHelp" class="hint" style="display:none"></div>

      <label for="pvtOrigin" style="margin-top:12px;">Flight Origin City:</label>
      <input id="pvtOrigin" placeholder="e.g., Van Nuys (VNY)" />
      <div id="pvtOriginHelp" class="hint" style="display:none"></div>
    </div>

    <!-- Date/Time -->
    <div class="input-row">
      <div>
        <label for="date">Date:</label>
        <input id="date" type="date" />
        <div id="dateHelp" class="helper"></div>
      </div>
      <div>
        <label for="time">Time:</label>
        <input id="time" type="time" step="900" />
        <div id="timeHelp" class="helper"></div>
      </div>
    </div>

    <!-- Vehicle -->
    <div class="veh-toggle">
      <button class="veh-btn active" data-type="suv">SUV (1–5 Passengers)</button>
      <button class="veh-btn" data-type="van">Van (up to 12 Passengers)</button>
    </div>
    <div class="turntable">
      <img class="car" src="/images/suburban.png" alt="Selected Vehicle">
      <div class="platform"></div>
      <div class="vehicle-caption">SUV — Max 5 passengers, 5 suitcases</div>
    </div>

    <!-- Luggage -->
    <div class="luggage-accordion" id="luggageAccordion">
      <div class="luggage-summary">
        <span class="luggage-title">Luggage Guidelines</span>
        <span class="luggage-chev"></span>
      </div>
      <div class="luggage-body">
        <div class="lug-section">
          <h4>SUV – 1 to 5 Passengers</h4>
          <h5>Option 1 – With Sports Equipment</h5>
          <ul>
            <li>5 sports equipment items (ski bags or golf bags)</li>
            <li>3 large suitcases (28–32”)</li>
            <li>3 small suitcases (20–24”)</li>
          </ul>
          <h5>Option 2 – Without Sports Equipment</h5>
          <ul>
            <li>4 large suitcases (28–32”)</li>
            <li>4 small suitcases (20–24”)</li>
          </ul>
        </div>
        <div class="lug-section">
          <h4>Van – Up to 12 Passengers</h4>
          <h5>Option 1 – With Sports Equipment</h5>
          <ul>
            <li>8 sports equipment items (ski bags or golf bags)</li>
            <li>8 large suitcases (28–32”)</li>
            <li>Carry-on: 1 per passenger</li>
          </ul>
          <h5>Option 2 – Without Sports Equipment</h5>
          <ul>
            <li>12–14 large suitcases (28–32”)</li>
            <li>Carry-on: 1 per passenger</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Terms pill -->
    <div class="terms-box" id="termsBox">
      <div class="terms-summary">
        <div class="accept-pill" id="acceptPill" tabindex="0" role="switch" aria-checked="false">
          <div class="accept-dot"></div>
        </div>
        <div class="accept-label">I accept the Terms &amp; Conditions</div>
      </div>
      <div class="terms-body">
        <div class="terms-content" id="termsContent" style="color:#e9d5c1; line-height:1.55">
          Minimum 24h. After-hours (10:00 PM–5:59 AM) +25%. Meet &amp; Greet at SLC +$50 (SUV only).
          County rule: if the pick-up is outside Summit/Wasatch, surcharge is $3 per mile (computed from our Kamas home base to your pick-up).
        </div>
        <button type="button" id="openTermsModal" class="readmore-btn" style="margin-top:8px;">View Full Terms</button>
      </div>
    </div>

    <!-- Actions -->
    <button id="calculate" disabled>Calculate Price</button>
    <div id="map"></div>
    <button id="pay" disabled style="display:none">PAY NOW</button>

    <!-- Summary -->
    <div id="info"></div>

    <!-- Reschedule -->
    <section id="reschedule" style="margin-top:24px;">
      <h3 style="color:#ffddae;margin:0 0 8px;">Reschedule</h3>
      <label for="cn">Reservation Code (CN)</label>
      <div style="display:flex; gap:8px; align-items:center;">
        <input id="cn" type="text" placeholder="BZ-TEST-01" required style="flex:1 1 auto;" />
        <button type="button" id="btnLoadCN" class="veh-btn" style="width:auto; padding:10px 14px;">Load Reservation</button>
      </div>
    </section>
  </main>

  <!-- Terms Modal -->
  <div class="modal-backdrop" id="termsModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-labelledby="termsTitle" aria-modal="true">
      <div class="modal-header">
        <h2 id="termsTitle" class="modal-title">Terms &amp; Conditions</h2>
        <button id="closeTerms" class="close-btn">Close</button>
      </div>
      <div class="modal-body" style="line-height:1.6">
        <h3 style="margin:0 0 8px;color:#ffddae">Terms and Conditions</h3>
        <div style="opacity:.85;margin-bottom:8px">Bonanza Transportation — Last updated: 2025</div>
        <div class="divider" style="height:1px;background:linear-gradient(90deg,transparent,rgba(192,139,92,.35),transparent);margin:8px 0 14px"></div>
        <p>— Minimum booking window: 24 hours in advance.</p>
        <p>— After-hours rides (10:00 PM–5:59 AM) add 25%.</p>
        <p>— Meet &amp; Greet at SLC is optional (+$50).</p>
        <p>— County rule: pick-up outside Summit/Wasatch → $3 per mile (Kamas base → pick-up).</p>
        <p>— No-shows and late cancellations may incur fees.</p>
        <p>— We process bookings exactly as entered by the customer.</p>
      </div>
    </div>
  </div>

  <!-- ======= Scripts (modulares) ======= -->
  <!-- 1) Config (Home Base, reglas, listas SLC/FBO/JSX, PK Stripe, backend flightcheck, etc.) -->
  <script>
    /* Config mínima inline para que el index ya funcione; luego movemos a scripts/config.js */
    window.BONANZA_CFG = {
      homeBaseAddress: "13742 N Jordan Parkway, Kamas, UT 84036",   // tu base
      afterHoursPct: 0.25,                                          // 25%
      afterHours: { start: 22, end: 6 },                            // 22:00–05:59
      meetGreetFee: 50,                                             // USD
      countyOutsidePerMile: 3,                                      // $3/mi (base -> pick-up)
      stripePk: "pk_test_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",        // cambia por tu PK
      flightcheckUrl: "https://flightcheck-7728622851.us-west3.run.app/flight",
      slcNames: ["Salt Lake City International Airport","SLC Airport","SLC Intl","SLC"],
      fboKeywords: ["TAC Air","Atlantic Aviation","OK3 Air","Million Air","Jet Center","Signature","Ross Aviation","Jet Linx","Modern Aviation","Provo Jet Center"]
    };
  </script>

  <!-- 2) UI utilidades (pill de T&C, luggage accordion, vehículo) -->
  <script src="./scripts/ui.js"></script>

  <!-- 3) Aeropuertos (heurísticas SLC / PVU / JSX / FBO + visibilidad de secciones y Meet&Greet) -->
  <script src="./scripts/airports.js"></script>

  <!-- 4) Maps (Places + Directions + cálculo de ruta + county pickup + millas base->pickup) -->
  <script src="./scripts/maps.js"></script>

  <!-- 5) Booking (validaciones + 24h + cálculo total con reglas nuevas) -->
  <script src="./scripts/booking.js"></script>

  <!-- 6) Stripe (Checkout con el total calculado) -->
  <script src="./scripts/stripe.js"></script>

  <!-- 7) (Opcional) Integración de vuelo al backend (Cloud Run) -->
  <script src="./scripts/flight.js"></script>

  <!-- Google Maps Loader (pon tu key) -->
  <script async src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places&callback=initMap"></script>
</body>
</html>
