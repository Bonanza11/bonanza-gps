<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reschedule — Bonanza Transportation</title>

  <!-- Estilos globales del sitio -->
  <link rel="stylesheet" href="/app/styles/app.css"/>

  <!-- Estilos locales -->
  <style>
    :root{ --copper:#a8744f; }
    body { background:#000; color:#e9d5c1; }
    .hidden{display:none !important;}

    .container{ max-width:1120px; margin:0 auto; padding:8px 16px 20px; }

    .card{
      position:relative;
      background:linear-gradient(180deg,#101010,#0b0b0b);
      border:1px solid rgba(192,139,92,.35);
      border-radius:16px; padding:14px 14px 16px;
      box-shadow:0 18px 40px rgba(0,0,0,.55);
    }
    .brand-badge{
      position:absolute; top:10px; right:12px;
      width:58px; height:58px; border-radius:50%;
      border:2px solid var(--copper);
      background:#000 url("/images/bonanza-logo.PNG") center/cover no-repeat;
      box-shadow:0 0 8px rgba(168,116,79,.35);
    }
    h1{
      margin:0 0 10px; font-size:1.35rem; color:#ffddae; text-align:center;
      letter-spacing:.2px;
    }

    .grid-main{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    @media (max-width:980px){ .grid-main{ grid-template-columns:1fr; } }

    .orig{
      background:#0b0b0b; border:1px solid rgba(168,116,79,.45);
      border-radius:12px; padding:12px;
    }
    .orig .head{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding-bottom:8px; border-bottom:1px solid rgba(168,116,79,.25);
    }
    .orig .label{ color:#cfa47f; font-size:.9rem; }
    .orig .value{ color:#ffddae; font-weight:800; }
    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:8px; }
    .grid3{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }

    label{ display:block; margin:8px 0 4px; font-weight:700 }
    input{ height:40px; font-size:14px; }
    .row{ display:flex; gap:8px; }
    .row>*{ flex:1 }
    #map{ height:220px; margin-top:8px; border-radius:12px; overflow:hidden }

    .pillbar{ display:flex; gap:8px; }
    .pillbar .pill{
      flex:1 1 0; text-align:center; padding:9px; border-radius:10px;
      background:#1a1a1a; color:var(--copper); border:1px solid rgba(168,116,79,.55);
      cursor:pointer; font-weight:700; font-size:.95rem;
    }
    .pillbar .pill.active{
      background:var(--copper); color:#000; border-color:var(--copper);
      box-shadow:0 0 0 3px rgba(168,116,79,.22);
    }

    .status{ min-height:18px; color:#ffcc66; margin:6px 0; font-size:.92rem }
    .muted{ color:#c9a97c; font-size:.9rem; margin-top:6px; }
    .summaryBox{
      margin-top:8px; background:#0e0e0e; border:1px solid rgba(168,116,79,.28);
      border-radius:12px; padding:10px;
    }

    button{ margin-top:8px; padding:12px 14px; font-size:16px }
    .ghost{ background:#1a1a1a; color:#ffddae; border:1px solid rgba(168,116,79,.45) }

    .divider{ height:1px; background:linear-gradient(90deg,transparent,rgba(192,139,92,.35),transparent); margin:10px 0; }

    .toprow{ display:flex; gap:10px; align-items:flex-end; margin-bottom:8px }
    .toprow>*:first-child{ flex:1 }
  </style>
</head>
<body>
  <main class="container">
    <div class="card">
      <div class="brand-badge" aria-hidden="true"></div>
      <h1>Reschedule Reservation</h1>

      <div class="toprow">
        <div>
          <label for="cn">Reservation Code (CN)</label>
          <input id="cn" placeholder="BZ-2025MMDD-XXXX" autocomplete="off"/>
        </div>
        <button id="load" style="flex:0 0 160px;">Load</button>
      </div>
      <div id="status" class="status"></div>

      <div class="grid-main">
        <!-- ORIGINAL TRIP -->
        <section id="original" class="orig hidden">
          <div class="head">
            <div>
              <div class="label">Reservation</div>
              <div class="value" id="o_cn">—</div>
            </div>
            <div style="text-align:right">
              <div class="label">Status</div>
              <div class="value" id="o_status">—</div>
            </div>
          </div>

          <div class="grid2" style="margin-top:8px">
            <div>
              <div class="label">Passenger</div>
              <div class="value" id="o_name">—</div>
            </div>
            <div>
              <div class="label">Email / Phone</div>
              <div class="value" id="o_contact">—</div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="grid2">
            <div>
              <div class="label">Pickup</div>
              <div class="value" id="o_pickup">—</div>
            </div>
            <div>
              <div class="label">Dropoff</div>
              <div class="value" id="o_dropoff">—</div>
            </div>
          </div>

          <div class="grid3" style="margin-top:8px">
            <div><div class="label">Date</div><div class="value" id="o_date">—</div></div>
            <div><div class="label">Time</div><div class="value" id="o_time">—</div></div>
            <div><div class="label">Vehicle</div><div class="value" id="o_vehicle">—</div></div>
          </div>

          <div class="grid3" style="margin-top:8px">
            <div><div class="label">Meet & Greet</div><div class="value" id="o_mg">—</div></div>
            <div><div class="label">Distance</div><div class="value" id="o_miles">—</div></div>
            <div><div class="label">Original Total</div><div class="value" id="o_total">—</div></div>
          </div>
        </section>

        <!-- NUEVO VIAJE -->
        <section id="form" class="hidden">
          <h2 style="margin:0 0 6px">Trip Details</h2>
          <!-- ... resto de campos ... -->
        </section>
      </div>
    </div>
  </main>

  <script>
    const $ = id => document.getElementById(id);
    const money = c => '$' + ((+c||0)/100).toFixed(2);

    let booking=null;

    document.addEventListener("DOMContentLoaded", () => {
      console.log("[Reschedule] DOM ready");

      const btn = $("load");
      if(!btn){ console.error("No se encontró el botón #load"); return; }

      btn.addEventListener("click", async () => {
        const cn = $("cn").value.trim();
        console.log("[Reschedule] Load clicked, CN=", cn);

        $("status").textContent = "Loading…";
        $("original").classList.add("hidden");

        try{
          const r = await fetch("/api/book/get?cn=" + encodeURIComponent(cn));
          const j = await r.json();
          console.log("[Reschedule] Response", r.status, j);

          if(!r.ok || !j.ok){
            $("status").textContent = j.error || "Reservation not found.";
            return;
          }

          booking = j.booking;

          $("o_cn").textContent = booking.confirmation_number;
          $("o_status").textContent = booking.status || "—";
          $("o_name").textContent = booking.full_name || "—";
          $("o_contact").textContent = [booking.email, booking.phone].filter(Boolean).join(" • ") || "—";
          $("o_pickup").textContent = booking.pickup || "—";
          $("o_dropoff").textContent = booking.dropoff || "—";
          $("o_date").textContent = booking.date_iso || "—";
          $("o_time").textContent = booking.time_hhmm || "—";
          $("o_vehicle").textContent = (booking.vehicle_type||"SUV").toUpperCase();
          $("o_mg").textContent = booking.mg_choice || "—";
          $("o_miles").textContent = booking.distance_miles ? Number(booking.distance_miles).toFixed(1)+" mi" : "—";
          $("o_total").textContent = money(booking.quoted_total);

          $("original").classList.remove("hidden");
          $("status").textContent = "Reservation loaded: " + booking.confirmation_number;
        }catch(e){
          console.error(e);
          $("status").textContent = "Error: " + (e.message||e);
        }
      });
    });
  </script>
</body>
</html>
