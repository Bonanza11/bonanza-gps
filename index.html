<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bonanza Transportation – GPS Estimate</title>
  <style>
    body{margin:0;font-family:Arial,sans-serif;background:#000;color:#c08b5c}
    header{text-align:center;padding:20px}
    header img{width:160px;height:160px;border-radius:50%;border:3px solid #c08b5c;object-fit:cover}
    main{max-width:420px;margin:0 auto;padding:20px}
    label{display:block;margin-top:12px;font-weight:700}
    input{width:100%;padding:8px;margin-top:4px;background:#1a1a1a;color:#c08b5c;border:1px solid #444;border-radius:6px}
    button{width:100%;padding:14px;margin-top:18px;background:#c08b5c;color:#000;font-weight:700;border:0;border-radius:10px;cursor:pointer}
    #map{height:380px;margin-top:18px;border-radius:10px}
    #info{background:#111;padding:14px;border-radius:10px;margin-top:16px;font-size:.95em}
    #info div{margin-bottom:6px}
    footer img{width:100%;margin:20px 0;border-radius:10px}
  </style>
</head>
  <link rel="icon" href="/favicon.ico">
<body>
  <header>
    <img src="bonanza-logo.PNG" alt="Bonanza Logo" />
  </header>

  <main>
    <label for="fullname">Full Name:</label>
    <input id="fullname" placeholder="e.g. John Doe"/>

    <label for="phone">Phone Number:</label>
    <input id="phone" placeholder="e.g. +1 385 123 4567"/>

    <label for="email">Email Address:</label>
    <input id="email" type="email" placeholder="e.g. your@email.com"/>

    <label for="pickup">Pick-up Address:</label>
    <input id="pickup" placeholder="e.g. 13742 N Jordanelle Pkwy"/>

    <label for="dropoff">Drop-off Address:</label>
    <input id="dropoff" placeholder="e.g. SLC Airport"/>

    <label for="date">Date:</label>
    <input id="date" type="date"/>

    <label for="time">Time:</label>
    <input id="time" type="time"/>

    <button onclick="calculateRoute()">Calculate Price</button>

    <div id="map"></div>

    <div id="info">
      <div><strong>Distance:</strong> <span id="distance">—</span></div>
      <div><strong>Duration:</strong> <span id="duration">—</span></div>
      <div><strong>Estimated Price:</strong> <span id="price">$0.00</span></div>
      <div><strong>Note:</strong> Pet-Friendly Service (No Extra Charge)</div>
      <div><strong>Vehicle:</strong> Black Suburban – 1–5 Passengers</div>
      <div><strong>Luggage:</strong> 5 ski bags, 2 large + 3 small or 3 large + 4 small suitcases</div>
    </div>

    <button onclick="payNow()">PAY NOW</button>
  </main>

  <footer>
    <img src="IMG_4072.png" alt="Bonanza SUV"/>
  </footer>

  <!-- ======== Lógica (una sola vez) ======== -->
  <script>
    let map, directionsService, directionsRenderer, calculatedPrice = 0;

    function initMap(){
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 40.646, lng: -111.498 },
        zoom: 11,
        mapTypeControl: false,
        streetViewControl: false,
        fullscreenControl: false
      });

      directionsService  = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer();
      directionsRenderer.setMap(map);

      new google.maps.places.Autocomplete(document.getElementById("pickup"));
      new google.maps.places.Autocomplete(document.getElementById("dropoff"));
    }
    window.initMap = initMap;

    function validateInputs(){
      const ids = ["fullname","phone","email","pickup","dropoff","date","time"];
      return ids.every(id => document.getElementById(id).value.trim());
    }

    function priceFromMiles(miles){
      if (miles <= 10) return 120;
      if (miles <= 35) return 190;
      if (miles <= 39) return 210;
      if (miles <= 48) return 230;
      if (miles <= 55) return 250;
      return miles * 5.4;
    }

    function calculateRoute(){
      if (!validateInputs()) { alert("Complete all fields."); return; }

      const origin      = document.getElementById("pickup").value.trim();
      const destination = document.getElementById("dropoff").value.trim();

      directionsService.route({
        origin, destination, travelMode: google.maps.TravelMode.DRIVING
      }, (res, status) => {
        if (status !== "OK" || !res) { alert("Could not calculate route."); return; }

        directionsRenderer.setDirections(res);
        const leg   = res.routes[0].legs[0];
        const miles = leg.distance.value / 1609.34;

        document.getElementById("distance").textContent = miles.toFixed(1) + " miles";
        document.getElementById("duration").textContent = leg.duration.text;

        calculatedPrice = priceFromMiles(miles);
        document.getElementById("price").textContent = "$" + calculatedPrice.toFixed(2);
      });
    }
    window.calculateRoute = calculateRoute;

    function payNow(){
      if (!validateInputs() || calculatedPrice <= 0){
        alert("Please calculate a price first.");
        return;
      }
      alert("Stripe vendrá aquí cuando conectes tu backend.");
    }
    window.payNow = payNow;
  </script>

  <!-- Carga ÚNICA de Google Maps (reemplaza TU_API_KEY) -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDN6B8izVVhi9CGiO-_TXdhquQAE_i5Lts&libraries=places&callback=initMap&loading=async" async defer></script>  
</body>
</html>
