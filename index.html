  console.log('Enviando monto a Stripe:', calculatedPrice);
  
fetch('/api/create-checkout-session', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({ amount: Math.round(price * 100) })
})
.then(async res => {
  if (!res.ok) throw new Error('Stripe backend error');
  const data = await res.json();
  if (data.id) {
    const stripe = Stripe('pk_live_51Rr9g0LxdVPME4zrYzx4WKgoT3NUZBSkWbwMnSmGPQCyE4MzzIufo6gM8EvLeTHOjQ5Vcn2V1GY0D9RrcJrOjRCd002MQFljOF'); // ⚠️ Reemplaza con tu clave pública real
    stripe.redirectToCheckout({ sessionId: data.id });
  } else {
    alert("Stripe session creation failed.");
  }
})
.catch(err => {
  console.error("Payment error:", err);
  alert("An error occurred while initiating payment.");
});
</script>
script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDN6B8izVVhi9CGiO-_TXdhquQAE_i5Lts&libraries=places&callback=initMap" async defer></script>
<script>
  let directionsService, directionsRenderer, calculatedPrice = 0;

  function priceFromMiles(miles){
    if (miles <= 10) return 120;
    if (miles <= 35) return 190;
    if (miles <= 39) return 210;
    if (miles <= 48) return 230;
    if (miles <= 55) return 250;
    return miles * 5.4;
  }

  async function calculateRoute(){
    const origin = document.getElementById('pickup').value.trim();
    const destination = document.getElementById('dropoff').value.trim();
    if (!origin || !destination){
      alert('Please enter pick-up and drop-off addresses.');
      return;
    }

    directionsService.route({
      origin,
      destination,
      travelMode: google.maps.TravelMode.DRIVING
    }, (res, status) => {
      if (status !== 'OK' || !res){
        alert('Could not calculate route. Please check the addresses.');
        return;
      }

      const leg = res.routes[0].legs[0];
      const meters = leg.distance.value;
      const miles  = meters / 1609.34;

      document.getElementById('distance').textContent = miles.toFixed(1) + ' miles';
      document.getElementById('duration').textContent = leg.duration.text;

      calculatedPrice = priceFromMiles(miles);
      document.getElementById('price').textContent = '$ ' + calculatedPrice.toFixed(2);
    });
  }
window.calculateRoute = calculateRoute;
  
  document.getElementById('calcBtn')?.addEventListener('click', calculateRoute);
</script>
</body>
</html>
