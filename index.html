<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bonanza Transportation – GPS Estimate</title>
  <style>
    body{margin:0;font-family:Arial,sans-serif;background:#000;color:#c08b5c}
    header{text-align:center;padding:20px}
    header img{width:160px;height:160px;border-radius:50%;border:3px solid #c08b5c;object-fit:cover}
    main{max-width:400px;margin:auto;padding:20px}
    label{display:block;margin-top:12px;font-weight:bold}
    input{width:100%;padding:8px;margin-top:4px;background:#1a1a1a;color:#c08b5c;border:1px solid #444;border-radius:6px}
    .error-message{color:#f55;font-size:.8em;display:none;margin-bottom:5px}
    button{width:100%;padding:14px;margin-top:20px;background:#c08b5c;color:#000;font-weight:bold;font-size:18px;border:0;border-radius:10px;cursor:pointer}
    #map{height:400px;margin-top:20px;border-radius:10px}
    #info{background:#111;padding:15px;border-radius:10px;margin-top:20px;font-size:.95em}
    #info div{margin-bottom:8px}
    footer img{width:100%;margin-top:20px;border-radius:10px}
  </style>
</head>
<body>
  <header>
    <img src="bonanza-logo.PNG" alt="Bonanza Logo" />
  </header>

  <main>
    <label for="fullname">Full Name:</label>
    <input type="text" id="fullname" placeholder="e.g. John Doe" />
    <div class="error-message" id="nameError">Please enter your full name.</div>

    <label for="phone">Phone Number:</label>
    <input type="tel" id="phone" placeholder="e.g. +1 385 123 4567" />
    <div class="error-message" id="phoneError">Please enter a valid phone number.</div>

    <label for="email">Email Address:</label>
    <input type="email" id="email" placeholder="e.g. your@email.com" />
    <div class="error-message" id="emailError">Please enter a valid email address.</div>

    <label for="pickup">Pick-up Address:</label>
    <input type="text" id="pickup" placeholder="e.g. 13742 N Jordanelle Pkwy" />
    <div class="error-message" id="pickupError">Please enter a pick-up address.</div>

    <label for="dropoff">Drop-off Address:</label>
    <input type="text" id="dropoff" placeholder="e.g. SLC Airport" />
    <div class="error-message" id="dropoffError">Please enter a drop-off address.</div>

    <label for="date">Date:</label>
    <input type="date" id="date" />
    <div class="error-message" id="dateError">Please select a date.</div>

    <label for="time">Time:</label>
    <input type="time" id="time" />
    <div class="error-message" id="timeError">Please select a time.</div>

    <button onclick="calculateRoute()">Calculate Price</button>

    <div id="map"></div>

    <div id="info">
      <div><strong>Distance:</strong> <span id="distance">—</span></div>
      <div><strong>Duration:</strong> <span id="duration">—</span></div>
      <div><strong>Estimated Price:</strong> <span id="price">$0.00</span></div>
      <div><strong>Note:</strong> Pet-Friendly Service (No Extra Charge)</div>
      <div><strong>Vehicle:</strong> Black Suburban – 1–5 Passengers</div>
      <div><strong>Luggage:</strong> 5 ski bags, 2 large + 3 small or 3 large + 4 small suitcases</div>
    </div>

    <button id="payBtn" onclick="payNow()">PAY NOW</button>
  </main>

  <footer>
    <img src="IMG_4072.png" alt="Bonanza SUV" />
  </footer>

  <!-- ===== Logic ===== -->
  <script>
    // Globals
    let map, directionsService, directionsRenderer, calculatedPrice = 0;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 40.646, lng: -111.498 },
        zoom: 11,
        mapTypeControl: false,
        streetViewControl: false,
        fullscreenControl: false
      });

      directionsService  = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer();
      directionsRenderer.setMap(map);

      new google.maps.places.Autocomplete(document.getElementById("pickup"));
      new google.maps.places.Autocomplete(document.getElementById("dropoff"));
    }
    window.initMap = initMap;

    function priceFromMiles(miles){
      if (miles <= 10) return 120;
      if (miles <= 35) return 190;
      if (miles <= 39) return 210;
      if (miles <= 48) return 230;
      if (miles <= 55) return 250;
      return miles * 5.4;
    }

    function validateInputs() {
      const fields = [
        { id: "fullname", errorId: "nameError" },
        { id: "phone",    errorId: "phoneError" },
        { id: "email",    errorId: "emailError" },
        { id: "pickup",   errorId: "pickupError" },
        { id: "dropoff",  errorId: "dropoffError" },
        { id: "date",     errorId: "dateError" },
        { id: "time",     errorId: "timeError" }
      ];
      let ok = true;
      fields.forEach(({id,errorId})=>{
        const el  = document.getElementById(id);
        const err = document.getElementById(errorId);
        if(!el.value.trim()){ err.style.display='block'; ok=false; }
        else { err.style.display='none'; }
      });
      return ok;
    }

    function calculateRoute(){
      if (!validateInputs()) return;

      const origin      = document.getElementById('pickup').value.trim();
      const destination = document.getElementById('dropoff').value.trim();

      directionsService.route({
        origin, destination,
        travelMode: google.maps.TravelMode.DRIVING
      }, (res, status) => {
        if (status !== 'OK' || !res){ alert('Could not calculate route.'); return; }

        directionsRenderer.setDirections(res);
        const leg   = res.routes[0].legs[0];
        const miles = leg.distance.value / 1609.34;

        document.getElementById('distance').textContent = miles.toFixed(1) + ' miles';
        document.getElementById('duration').textContent = leg.duration.text;

        calculatedPrice = priceFromMiles(miles);
        document.getElementById('price').textContent = '$' + calculatedPrice.toFixed(2);
      });
    }
    window.calculateRoute = calculateRoute;

    function payNow(){
      if (!validateInputs() || calculatedPrice <= 0){
        alert("Please calculate a price first.");
        return;
      }
      // TODO: integrar Stripe backend; por ahora solo mostramos el monto
      alert("Amount to charge: $" + calculatedPrice.toFixed(2));
      // fetch('/api/create-checkout-session', {... body: JSON.stringify({ amount: Math.round(calculatedPrice * 100) }) })
    }
    window.payNow = payNow;
  </script>

  <!-- Google Maps (carga única) -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDN6B8izVVhi9CGiO-_TXdhquQAE_i5Lts&libraries=places&callback=initMap" async defer></script>
</body>
</html>
