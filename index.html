<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Bonanza Transportation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <link
    href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css"
    rel="stylesheet"
    type="text/css"
  />
  <style>
    body {
      background-color: #000;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      color: #d37d39;
    }
    h1 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 30px;
      text-shadow: 1px 1px 2px #000;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #d37d39;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      background-color: #222;
      color: #fff;
    }
    #calculateBtn {
      display: block;
      width: 100%;
      margin: 20px 0;
      padding: 14px;
      font-size: 18px;
      background-color: #d37d39;
      border: none;
      border-radius: 6px;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    #calculateBtn:hover {
      background-color: #ff9955;
    }
    #map {
      width: 100%;
      height: 300px;
      margin-top: 20px;
      border-radius: 12px;
    }
    #distance, #duration, #price {
      margin-top: 15px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>Bonanza Transportation</h1>

  <label for="pickup">Pick-up Address:</label>
  <input type="text" id="pickup" placeholder="e.g. 13742 N Jordanelle Pkwy" />

  <label for="dropoff">Drop-off Address:</label>
  <input type="text" id="dropoff" placeholder="e.g. SLC Airport" />

  <button id="calculateBtn">Estimated Price</button>

  <div id="map"></div>

  <div id="distance"></div>
  <div id="duration"></div>
  <div id="price"></div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiYm9uYW56YTEiLCJhIjoiY21kdDY3bGhzMHhlZzJsb2RpdTExbWV4eCJ9.dGYSOsvJ1tKnIKq-rvFScg';

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/dark-v10',
      center: [-111.5, 40.6],
      zoom: 8,
      interactive: true
    });

    const geocoderPickup = new MapboxGeocoder({
      accessToken: mapboxgl.accessToken,
      placeholder: 'Pick-up location',
      mapboxgl: mapboxgl,
      marker: false
    });
    const geocoderDropoff = new MapboxGeocoder({
      accessToken: mapboxgl.accessToken,
      placeholder: 'Drop-off location',
      mapboxgl: mapboxgl,
      marker: false
    });

    let startCoords = null;
    let endCoords = null;
    let pickupMarker = null;
    let dropoffMarker = null;

    document.getElementById('pickup').addEventListener('change', async (e) => {
      const address = e.target.value;
      const res = await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(address)}.json?access_token=${mapboxgl.accessToken}`);
      const data = await res.json();
      if (data.features && data.features.length > 0) {
        startCoords = data.features[0].geometry.coordinates;
        if (pickupMarker) pickupMarker.remove();
        pickupMarker = new mapboxgl.Marker({ color: '#f60' }).setLngLat(startCoords).addTo(map);
        map.flyTo({ center: startCoords, zoom: 10 });
      }
    });

    document.getElementById('dropoff').addEventListener('change', async (e) => {
      const address = e.target.value;
      const res = await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(address)}.json?access_token=${mapboxgl.accessToken}`);
      const data = await res.json();
      if (data.features && data.features.length > 0) {
        endCoords = data.features[0].geometry.coordinates;
        if (dropoffMarker) dropoffMarker.remove();
        dropoffMarker = new mapboxgl.Marker({ color: '#0af' }).setLngLat(endCoords).addTo(map);
        map.flyTo({ center: endCoords, zoom: 10 });
      }
    });

    document.getElementById('calculateBtn').addEventListener('click', async () => {
      if (!startCoords || !endCoords) {
        alert('Please enter both pick-up and drop-off addresses.');
        return;
      }

      const url = `https://api.mapbox.com/directions/v5/mapbox/driving/${startCoords[0]},${startCoords[1]};${endCoords[0]},${endCoords[1]}?geometries=geojson&access_token=${mapboxgl.accessToken}`;
      const res = await fetch(url);
      const data = await res.json();

      if (data.routes && data.routes.length > 0) {
        const route = data.routes[0];
        const distanceMiles = (route.distance / 1609.34).toFixed(1);
        const durationMin = Math.round(route.duration / 60);
        const coords = route.geometry.coordinates;

        // Mostrar ruta
        if (map.getSource('route')) {
          map.removeLayer('route');
          map.removeSource('route');
        }

        map.addSource('route', {
          type: 'geojson',
          data: {
            type: 'Feature',
            geometry: {
              type: 'LineString',
              coordinates: coords
            }
          }
        });

        map.addLayer({
          id: 'route',
          type: 'line',
          source: 'route',
          layout: { 'line-join': 'round', 'line-cap': 'round' },
          paint: { 'line-color': '#d37d39', 'line-width': 5 }
        });

        // Calcular precio
        let price = 0;
        const dist = parseFloat(distanceMiles);

        if (dist <= 10) price = 120;
        else if (dist <= 35) price = 190;
        else if (dist <= 39) price = 210;
        else if (dist <= 48) price = 230;
        else if (dist <= 55) price = 250;
        else price = (dist * 5.4).toFixed(2);

        document.getElementById('distance').textContent = `Distance: ${distanceMiles} miles`;
        document.getElementById('duration').textContent = `Estimated Time: ${durationMin} minutes`;
        document.getElementById('price').textContent = `Estimated Price: $${price}`;
      } else {
        alert('Unable to calculate route.');
      }
    });
  </script>
</body>
</html>
