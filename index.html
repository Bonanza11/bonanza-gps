<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bonanza Transportation</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #0c0c0c;
      color: #f5f5f5;
      padding-bottom: 100px;
    }

    header {
      text-align: center;
      padding: 20px;
    }

    header img {
      max-width: 200px;
      margin-bottom: 10px;
    }

    h1 {
      color: #d1884f;
    }

    form {
      max-width: 600px;
      margin: auto;
      padding: 20px;
      background-color: #1a1a1a;
      border-radius: 10px;
    }

    label {
      display: block;
      margin-top: 15px;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: none;
      border-radius: 5px;
      background: #333;
      color: white;
    }

    .valid::after {
      content: '✔️';
      margin-left: 8px;
      color: green;
    }

    .invalid::after {
      content: '❌';
      margin-left: 8px;
      color: red;
    }

    #calculateBtn, #payBtn {
      margin-top: 20px;
      padding: 15px;
      width: 100%;
      background-color: #d1884f;
      color: black;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    #calculateBtn:hover, #payBtn:hover {
      background-color: #b36b2c;
    }

    #map {
      height: 300px;
      margin: 20px auto;
      max-width: 600px;
      border-radius: 10px;
    }

    #trip-info {
      text-align: center;
      margin-top: 20px;
    }

    .vehicle {
      display: block;
      margin: 30px auto;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <header>
    <img src="bonanza-logo.PNG" alt="Bonanza Logo"/>
    <h1>Book Your Ride</h1>
  </header>

  <form id="bookingForm">
    <label>Pick-up Address:
      <input id="pickup" type="text" placeholder="Enter pick-up location" required />
    </label>

    <label>Drop-off Address:
      <input id="dropoff" type="text" placeholder="Enter drop-off location" required />
    </label>

    <label>Date:
      <input id="date" type="date" required />
    </label>

    <label>Time:
      <input id="time" type="time" required />
    </label>

    <button id="calculateBtn" type="button">Calculate Price</button>
    <button id="payBtn" type="button" style="display: none;">PAY NOW</button>
  </form>

  <div id="trip-info"></div>
  <img class="vehicle" src="IMG_4072.png" alt="Suburban SUV"/>

  <div id="map"></div>

  <script>
    let price = 0;

    function validateInputs() {
      document.querySelectorAll('input').forEach(input => {
        input.classList.remove("valid", "invalid");
        if (input.value.trim()) {
          input.classList.add("valid");
        } else {
          input.classList.add("invalid");
        }
      });
    }

    async function calculateRoute() {
      validateInputs();
      const origin = document.getElementById("pickup").value;
      const destination = document.getElementById("dropoff").value;

      if (!origin || !destination) return;

      const directionsService = new google.maps.DirectionsService();
      const results = await directionsService.route({
        origin,
        destination,
        travelMode: google.maps.TravelMode.DRIVING,
      });

      const route = results.routes[0].legs[0];
      const distanceText = route.distance.text;
      const durationText = route.duration.text;
      const distanceMiles = parseFloat(route.distance.value) / 1609;

      price = Math.round(75 + distanceMiles * 3);

      document.getElementById("trip-info").innerHTML = `
        <h3>Distance: ${distanceText}</h3>
        <h3>Duration: ${durationText}</h3>
        <h2>Estimated Price: $${price}</h2>
      `;

      new google.maps.DirectionsRenderer({ map }).setDirections(results);
      document.getElementById("payBtn").style.display = "block";
    }

    document.getElementById("calculateBtn").addEventListener("click", calculateRoute);

    document.getElementById("payBtn").addEventListener("click", async () => {
      try {
        const res = await fetch("/api/create-checkout-session", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ price: price * 100 })
        });
        const data = await res.json();
        if (data.url) window.location.href = data.url;
        else alert("Error creating payment session.");
      } catch (err) {
        alert("An error occurred while initiating payment.");
      }
    });

    let map;
    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 40.7608, lng: -111.8910 },
        zoom: 11,
        styles: [{ elementType: "geometry", stylers: [{ color: "#1a1a1a" }] }]
      });

      const autocompleteOptions = {
        fields: ["place_id", "geometry", "name"],
        types: ["address"],
      };
      new google.maps.places.Autocomplete(document.getElementById("pickup"), autocompleteOptions);
      new google.maps.places.Autocomplete(document.getElementById("dropoff"), autocompleteOptions);
    }
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDN6B8izVVhi9CGiO-_TXdhquQAE_i5Lts&libraries=places&callback=initMap">
  </script>
</body>
</html>
